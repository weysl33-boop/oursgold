# 贵金属汇率行情App PRD

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档名称 | 贵金属汇率行情App PRD |
| 文档版本 | V1.1 |
| 文档作者 | Claude PM |
| 创建日期 | 2025-12-25 |
| 最后更新 | 2025-12-27 |
| 文档状态 | 草稿 |
| 项目优先级 | P0 |

### 更新记录

| 版本 | 日期 | 作者 | 更新内容 |
|------|------|------|----------|
| V1.0 | 2025-12-25 | Claude PM | 初稿，包含核心功能页面设计 |
| V1.1 | 2025-12-27 | Claude PM | 新增价格预测互动系统：ABCD投票、预测准确性验证、预测达人榜等社区增强功能 |

---

## 1. 需求概述

### 1.1 需求背景

**业务背景**

随着全球经济波动加剧，贵金属和外汇市场成为投资者关注的焦点。黄金、白银作为避险资产，以及主要货币的汇率变化，都是用户日常关注的重要金融信息。现有市场上的金融行情App大多功能繁杂、操作复杂，缺乏社交互动属性，用户难以获得实时的市场情绪反馈。

**重要说明：本产品定位为纯社区互动平台，不涉及任何交易功能和投资建议服务。**

**用户场景**

- 投资者需要实时查看贵金属和汇率行情，做出投资决策
- 用户希望在查看价格时能看到其他人的评价和观点
- 用户需要便捷的货币兑换计算工具
- 用户希望与其他投资者交流讨论市场走势
- **用户希望发表对价格走势的预测，并与其他用户互动讨论**
- **用户希望验证自己预测的准确性，展示前瞻性眼光**
- **用户希望看到其他用户的预测表现，发现预测达人**

**需求来源**

- 市场调研发现用户对行情+社交的需求
- 竞品分析显示差异化机会
- 移动端金融信息获取需求增长

### 1.2 产品目标

**用户目标**

- 快速获取黄金、白银、主要货币的实时行情
- 便捷进行货币兑换计算
- 参与行情讨论，获取他人观点
- 记录自己对某一时刻价格的看法
- **发起价格预测投票，邀请他人参与讨论**
- **通过预测验证展示自己的市场洞察力**
- **关注预测达人，学习其分析方法**

**商业目标**

- 构建金融社区，提升用户粘性
- 通过DAU和用户留存建立商业价值基础
- 为后续增值服务（如付费资讯、VIP会员）奠定用户基础
- **通过预测互动机制形成良性社区氛围，增强用户参与度**

**目标用户**

| 用户类型 | 特征描述 | 占比 |
|---------|---------|------|
| 投资小白 | 对贵金属/外汇感兴趣，希望入门学习 | 40% |
| 业余投资者 | 有一定投资经验，定期关注行情 | 35% |
| 专业投资者 | 频繁交易，需要实时数据和深度分析 | 15% |
| 从业人员 | 金融行业相关人员，获取市场动态 | 10% |

### 1.3 产品范围

**本期范围（MVP）**

1. ✅ 首页 - 行情概览卡片网格
2. ✅ 行情页 - 黄金/白银详细行情列表
3. ✅ 汇率页 - 实时汇率+货币兑换计算器
4. ✅ 详情页 - K线图表+价格评论+**价格预测投票**
5. ✅ 讨论区 - 热门话题榜+品种关注榜+**预测达人榜**
6. ✅ 个人中心 - 用户资料+账号管理+**预测成绩**
7. ✅ **价格预测系统 - ABCD投票+预测验证+准确性评分**

**不在范围内**

- ❌ 实际交易功能（无交易资质，纯社区产品）
- ❌ 资产组合管理
- ❌ 投资建议服务
- ❌ 付费会员体系
- 推送通知系统（后续版本）
- AI智能分析（后续版本，首页AI图标预留入口）

**依赖条件**

- 实时行情数据API接入
- 用户认证系统
- 评论内容审核系统
- K线图表组件库

**技术栈选型**

| 端 | 技术栈 | 说明 |
|---|-------|------|
| 移动端 | Flutter | 跨平台开发，同时支持iOS和Android |
| 后端 | Python FastAPI | 高性能异步API框架 |
| 数据库 | PostgreSQL + Redis | 主数据库 + 缓存/实时数据 |
| 实时通信 | WebSocket | 行情实时推送 |

---

## 2. 市场与用户分析

### 2.1 市场分析

**市场趋势**

- 移动端金融信息获取已成为主流
- 金融产品社交化趋势明显
- 贵金属投资热度持续上升
- 汇率波动频繁，用户关注度提高

### 2.2 竞品分析

| 竞品名称 | 核心功能 | 优势 | 劣势 | 差异化点 |
|---------|---------|------|------|---------|
| 英为财情 | 全品种行情+资讯 | 数据全面、专业 | 界面复杂、社交弱 | 专业深度 |
| 金荣中国App | 贵金属行情+交易 | 支持交易、实时数据 | 偏重交易、门槛高 | 交易导向 |
| 掌上黄金 | 黄金专项行情 | 专注黄金、简洁 | 品种单一、无社交 | 专一品种 |

**我们的差异化优势**

- 行情+社交深度结合
- 独创"评论锚定价格"机制
- **独创"价格预测投票"互动玩法**
- **预测准确性验证与达人成长体系**
- 界面简洁、上手门槛低
- **良性社区互动氛围，激励前瞻性洞察**
- 纯社区逻辑，无交易门槛

### 2.3 用户研究

**用户痛点**

1. **信息过载**：现有App功能繁杂，新手难以快速获取关键信息
2. **缺乏互动**：看行情时无法得知市场情绪和他人观点
3. **评论缺乏语境**：传统评论无法关联当时的价格，回顾时失去参考价值
4. **计算不便**：需要单独打开计算器进行汇率换算

---

## 3. 功能架构

### 3.1 产品架构图

```
┌─────────────────────────────────────────────────────────────────────┐
│                        贵金属汇率行情App                              │
├───────────┬───────────┬───────────┬─────────────┬──────────────────┤
│   首页    │   行情    │   汇率    │   讨论区    │     个人中心      │
├───────────┼───────────┼───────────┼─────────────┼──────────────────┤
│ · 搜索栏  │ · 黄金    │ · 汇率展示│ · 话题榜    │ · 用户资料       │
│ · AI入口  │ · 白银    │ · 计算器  │ · 关注榜    │ · 账号绑定       │
│ · 行情卡片│ · 分类导航│ · 货币列表│ · 点赞榜    │ · 偏好设置       │
│           │ · 详情入口│           │ · 预测达人榜│ · 语言切换       │
│           │           │           │ · 准确率榜  │ · 我的预测成绩   │
└───────────┴───────────┴───────────┴─────────────┴──────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────┐
│                          详情页（通用）                               │
├─────────────────────────────────────────────────────────────────────┤
│ · K线图表（分时/日K/周K/月K）                                        │
│ · 实时价格信息                                                       │
│ · 价格评论区（带价格锚定）                                           │
│ · 价格预测投票（ABCD选项互动）                                       │
│ · 预测结果验证与准确性展示                                           │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.2 导航结构

底部Tab导航（5个Tab）：
- 首页（Home）
- 行情（Market）
- 汇率（Exchange）
- 讨论区（Community）
- 我的（Profile）

---

## 4. 核心功能详细说明

### 4.0 交易品种数据结构

#### 4.0.1 支持的交易市场与品种

**上海黄金交易所 (SGE)**

| 品种类型 | 合约名称 | 代码 | 说明 |
|---------|---------|------|------|
| 黄金 | 现货实盘合约 | Au99.99 | 实物交割，纯度不低于99.99% |
| 黄金 | 现货实盘合约 | Au99.95 | 实物交割，纯度不低于99.95% |
| 黄金 | 现货实盘合约（金条100g）| Au100g | 100克规格金条 |
| 黄金 | 延期交收合约 | Au(T+D) | 保证金交易，带杠杆，可双向操作 |
| 黄金 | 迷你黄金延期交收合约 | mAu(T+D) | 降低交易单位的T+D合约 |
| 黄金 | 集中定价合约（上海金）| SHAU | 提供人民币基准价 |
| 白银 | 延期交收合约 | Ag(T+D) | 保证金交易，带杠杆 |
| 白银 | 集中定价合约（上海银）| SHAG | 提供人民币基准价 |

**国际现货市场 (LBMA)**

| 品种类型 | 合约名称 | 代码 | 说明 |
|---------|---------|------|------|
| 黄金 | 现货黄金（伦敦金）| XAU / XAUUSD | 全球现货黄金定价基准，场外交易 |
| 白银 | 现货白银（伦敦银）| XAG / XAGUSD | 全球现货白银定价基准，场外交易 |
| 铂金 | 现货铂金 | XPT | 铂金现货 |
| 钯金 | 现货钯金 | XPD | 钯金现货 |

**纽约商品交易所 (COMEX)**

| 品种类型 | 合约名称 | 代码 | 说明 |
|---------|---------|------|------|
| 黄金 | 黄金期货 | GC | 全球最活跃的黄金期货合约 |
| 白银 | 白银期货 | SI | 全球白银期货基准 |

**主要货币 (外汇)**

| 货币名称 | ISO代码 | 常见表示 | 说明 |
|---------|---------|---------|------|
| 美元 | USD | USD (美元) | 国际主要储备货币 |
| 欧元 | EUR | EUR/USD (欧元/美元) | 欧盟官方货币，外汇市场交易量最大的货币之一 |
| 人民币 | CNY | USD/CNY (美元/人民币) | 中国法定货币，国际金融交易标准代码 |
| 英镑 | GBP | GBP/USD (英镑/美元) | 英国法定货币 |
| 日元 | JPY | USD/JPY (美元/日元) | 日本法定货币 |
| 澳元 | AUD | AUD/USD (澳元/美元) | 澳大利亚法定货币 |
| 加元 | CAD | USD/CAD (美元/加元) | 加拿大法定货币 |
| 瑞士法郎 | CHF | USD/CHF (美元/瑞郎) | 瑞士法定货币 |
| 港币 | HKD | USD/HKD (美元/港币) | 香港法定货币 |

#### 4.0.2 品种数据模型

```python
# FastAPI 后端数据模型示例

class Market(str, Enum):
    SGE = "SGE"        # 上海黄金交易所
    LBMA = "LBMA"      # 伦敦金银市场协会
    COMEX = "COMEX"    # 纽约商品交易所
    FOREX = "FOREX"    # 外汇市场

class SymbolType(str, Enum):
    GOLD = "gold"      # 黄金
    SILVER = "silver"  # 白银
    PLATINUM = "platinum"  # 铂金
    PALLADIUM = "palladium"  # 钯金
    CURRENCY = "currency"  # 货币

class Symbol(BaseModel):
    code: str              # 品种代码，如 "XAUUSD"
    name_cn: str           # 中文名称，如 "伦敦金"
    name_en: str           # 英文名称，如 "Spot Gold"
    market: Market         # 所属市场
    symbol_type: SymbolType  # 品种类型
    base_currency: str     # 基础货币
    quote_currency: str    # 报价货币
    decimal_places: int    # 小数位数
    unit: str              # 单位，如 "盎司"、"克"
    description: str       # 品种说明

class Quote(BaseModel):
    symbol_code: str       # 品种代码
    price: Decimal         # 当前价格
    change: Decimal        # 涨跌额
    change_percent: Decimal  # 涨跌幅
    high: Decimal          # 最高价
    low: Decimal           # 最低价
    open: Decimal          # 开盘价
    prev_close: Decimal    # 昨收价
    volume: Optional[int]  # 成交量
    timestamp: datetime    # 时间戳
```

#### 4.0.3 行情分类导航结构

```
行情页导航结构：
├── 黄金
│   ├── 国际黄金
│   │   ├── XAU/USD (伦敦金)
│   │   └── GC (COMEX黄金期货)
│   └── 国内黄金
│       ├── Au99.99
│       ├── Au99.95
│       ├── Au100g
│       ├── Au(T+D)
│       ├── mAu(T+D)
│       └── SHAU (上海金)
├── 白银
│   ├── 国际白银
│   │   ├── XAG/USD (伦敦银)
│   │   └── SI (COMEX白银期货)
│   └── 国内白银
│       ├── Ag(T+D)
│       └── SHAG (上海银)
└── 其他贵金属（可选扩展）
    ├── XPT (铂金)
    └── XPD (钯金)
```

### 4.1 首页

#### 4.1.1 功能描述

首页作为App的入口，提供全局行情概览，让用户快速获取黄金、白银、主要汇率品种的实时信息。

#### 4.1.2 页面布局

```
┌────────────────────────────────────┐
│  ┌────────────────────────┐ [AI]  │  ← 搜索栏 + AI图标
│  │      搜索品种...       │       │
│  └────────────────────────┘       │
├────────────────────────────────────┤
│  ┌───────────┐  ┌───────────┐     │
│  │  黄金Au   │  │  白银Ag   │     │  ← 行情卡片网格
│  │  2658.50  │  │  30.25    │     │     (每行2个)
│  │  ▲ +1.2%  │  │  ▼ -0.8%  │     │
│  └───────────┘  └───────────┘     │
│  ┌───────────┐  ┌───────────┐     │
│  │  USD/CNY  │  │  EUR/CNY  │     │
│  │  7.2456   │  │  7.8923   │     │
│  │  ▲ +0.15% │  │  ▼ -0.23% │     │
│  └───────────┘  └───────────┘     │
│  ┌───────────┐  ┌───────────┐     │
│  │  GBP/CNY  │  │  JPY/CNY  │     │
│  │  9.1234   │  │  0.0486   │     │
│  │  ▲ +0.08% │  │  ▲ +0.12% │     │
│  └───────────┘  └───────────┘     │
│          ...更多品种...            │
└────────────────────────────────────┘
```

#### 4.1.3 功能规则

**搜索栏**
- 位置：页面顶部固定
- 功能：支持品种名称、代码搜索
- 右侧AI图标：作为未来AI功能入口预留
- 点击搜索栏展开搜索页面，支持实时联想

**行情卡片**

| 元素 | 说明 |
|-----|------|
| 品种名称 | 中文名称 + 代码（如：黄金 Au） |
| 当前价格 | 实时价格，精确到小数点后2-4位 |
| 涨跌幅 | 较昨收涨跌百分比 |
| 涨跌标识 | 红色向上箭头（涨）/ 绿色向下箭头（跌）|
| 卡片样式 | 圆角矩形，轻微阴影，每行2个 |

**涨跌颜色规则**
- 默认：红涨绿跌（中国习惯）
- 可在个人中心切换为：绿涨红跌（国际习惯）

#### 4.1.4 交互说明

| 操作 | 响应 |
|-----|------|
| 点击搜索栏 | 进入搜索页面 |
| 点击AI图标 | 显示"功能即将上线"提示 |
| 点击行情卡片 | 进入该品种详情页 |
| 下拉页面 | 刷新行情数据 |

#### 4.1.5 验收标准

- [ ] 搜索栏固定在顶部，AI图标位于右侧
- [ ] 行情卡片网格布局，每行2个
- [ ] 价格实时更新（间隔≤5秒）
- [ ] 涨跌颜色正确显示
- [ ] 点击卡片可正确跳转详情页

---

### 4.2 行情页

#### 4.2.1 功能描述

行情页提供黄金、白银两大类贵金属的详细行情列表，支持分类导航切换，用户可查看更多品种的详细信息。

#### 4.2.2 页面布局

```
┌────────────────────────────────────┐
│  [ 黄金 ]    [ 白银 ]              │  ← 可滑动分类导航Tab
├────────────────────────────────────┤
│  ┌──────────────────────────────┐  │
│  │  伦敦金 (XAU/USD)            │  │
│  │  现价: 2658.50  ▲ +28.30    │  │
│  │  涨幅: +1.08%                │  │
│  │  最高: 2665.20  最低: 2630.00│  │
│  └──────────────────────────────┘  │
│  ┌──────────────────────────────┐  │
│  │  Au9999                      │  │
│  │  现价: 614.50   ▲ +3.20     │  │
│  │  涨幅: +0.52%                │  │
│  │  最高: 616.80   最低: 610.00 │  │
│  └──────────────────────────────┘  │
│  ┌──────────────────────────────┐  │
│  │  Au99.95                     │  │
│  │  现价: 613.80   ▲ +2.90     │  │
│  │  涨幅: +0.47%                │  │
│  │  最高: 615.50   最低: 609.50 │  │
│  └──────────────────────────────┘  │
│           ↓ 下拉加载更多           │
└────────────────────────────────────┘
```

#### 4.2.3 功能规则

**分类导航**

| 分类 | 包含品种 |
|-----|---------|
| 黄金 | 伦敦金(XAU/USD)、Au9999、Au99.95、Au T+D、黄金期货等 |
| 白银 | 伦敦银(XAG/USD)、Ag9999、Ag T+D、白银期货等 |

**行情列表项**

| 字段 | 说明 |
|-----|------|
| 品种名称 | 中文名称 + 英文代码 |
| 现价 | 当前实时价格 |
| 涨跌额 | 较昨收价格变化值 |
| 涨跌幅 | 较昨收涨跌百分比 |
| 最高/最低 | 当日最高价和最低价 |

#### 4.2.4 交互说明

| 操作 | 响应 |
|-----|------|
| 左右滑动导航Tab | 切换黄金/白银分类 |
| 点击导航Tab | 切换到对应分类 |
| 点击行情列表项 | 进入该品种详情页 |
| 下拉列表 | 加载更多品种 |
| 下拉刷新 | 刷新当前分类数据 |

#### 4.2.5 验收标准

- [ ] 分类导航Tab可滑动切换
- [ ] 黄金/白银分类数据正确展示
- [ ] 行情列表支持下拉加载更多
- [ ] 点击列表项正确跳转详情页
- [ ] 数据实时更新

---

### 4.3 汇率页

#### 4.3.1 功能描述

汇率页提供主要货币对的实时汇率展示，并集成双向货币兑换计算器，方便用户快速进行货币换算。

#### 4.3.2 页面布局

```
┌────────────────────────────────────┐
│           汇率换算计算器            │
├────────────────────────────────────┤
│  ┌─────────┐    ┌─────────────┐   │
│  │  USD ▼  │    │    100.00   │   │  ← 输入货币和金额
│  └─────────┘    └─────────────┘   │
│              ⇅ (切换按钮)          │
│  ┌─────────┐    ┌─────────────┐   │
│  │  CNY ▼  │    │    724.56   │   │  ← 输出货币和结果
│  └─────────┘    └─────────────┘   │
├────────────────────────────────────┤
│         主要货币汇率（基于1美元）    │
├────────────────────────────────────┤
│  ┌──────────────────────────────┐  │
│  │  🇪🇺 EUR 欧元                 │  │
│  │  1 USD = 0.9234 EUR          │  │
│  │  ▼ -0.15%                    │  │
│  └──────────────────────────────┘  │
│  ┌──────────────────────────────┐  │
│  │  🇨🇳 CNY 人民币               │  │
│  │  1 USD = 7.2456 CNY          │  │
│  │  ▲ +0.08%                    │  │
│  └──────────────────────────────┘  │
│  ┌──────────────────────────────┐  │
│  │  🇬🇧 GBP 英镑                 │  │
│  │  1 USD = 0.7892 GBP          │  │
│  │  ▼ -0.12%                    │  │
│  └──────────────────────────────┘  │
│  ┌──────────────────────────────┐  │
│  │  🇯🇵 JPY 日元                 │  │
│  │  1 USD = 149.23 JPY          │  │
│  │  ▲ +0.25%                    │  │
│  └──────────────────────────────┘  │
│           ...更多货币...           │
└────────────────────────────────────┘
```

#### 4.3.3 功能规则

**货币兑换计算器**

| 元素 | 说明 |
|-----|------|
| 源货币选择器 | 下拉选择源货币，默认USD |
| 源金额输入框 | 支持数字输入，支持小数 |
| 切换按钮 | 一键交换源货币和目标货币 |
| 目标货币选择器 | 下拉选择目标货币，默认CNY |
| 目标金额显示 | 实时计算并显示换算结果 |

**计算规则**
- 实时获取汇率进行计算
- 结果保留2位小数
- 输入变化时实时更新结果
- 支持双向计算

**货币列表**

| 货币代码 | 货币名称 | 国旗 |
|---------|---------|------|
| EUR | 欧元 | 🇪🇺 |
| CNY | 人民币 | 🇨🇳 |
| GBP | 英镑 | 🇬🇧 |
| JPY | 日元 | 🇯🇵 |
| AUD | 澳元 | 🇦🇺 |
| CAD | 加元 | 🇨🇦 |
| CHF | 瑞郎 | 🇨🇭 |
| HKD | 港币 | 🇭🇰 |
| ... | 更多 | ... |

#### 4.3.4 交互说明

| 操作 | 响应 |
|-----|------|
| 点击货币选择器 | 弹出货币选择列表 |
| 输入金额 | 实时计算换算结果 |
| 点击切换按钮 | 交换源货币和目标货币 |
| 点击货币列表项 | 进入该货币对的详情页 |
| 下拉页面 | 刷新汇率数据 |

#### 4.3.5 验收标准

- [ ] 计算器支持双向货币选择
- [ ] 金额输入实时计算结果
- [ ] 切换按钮正确交换货币
- [ ] 货币列表显示国旗、名称、汇率、涨跌幅
- [ ] 汇率数据实时更新

---

### 4.4 详情页（核心功能）

#### 4.4.1 功能描述

详情页是所有品种（黄金、白银、货币）的通用详情展示页面，包含K线图表和独特的"价格锚定评论区"功能。这是本产品的核心差异化功能。

#### 4.4.2 页面布局

```
┌────────────────────────────────────┐
│  ← 返回    伦敦金 XAU/USD    ☆     │  ← 顶部导航栏
├────────────────────────────────────┤
│         2658.50                    │
│      ▲ +28.30 (+1.08%)            │  ← 实时价格区
│    最高: 2665.20  最低: 2630.00    │
├────────────────────────────────────┤
│  [分时] [日K] [周K] [月K]          │  ← K线周期切换
├────────────────────────────────────┤
│                                    │
│         📈 K线图表区域             │  ← K线图表
│                                    │
│                                    │
├────────────────────────────────────┤
│  评论区 (156条)              发布 + │  ← 评论区标题
├────────────────────────────────────┤
│  ┌──────────────────────────────┐  │
│  │ 👤 用户A       2小时前       │  │
│  │ ┌────────────────────────┐   │  │
│  │ │ 💰 评论时价格: 2650.30  │   │  │  ← 价格锚定标签
│  │ └────────────────────────┘   │  │
│  │ 感觉要突破2660了，准备      │  │
│  │ 加仓！                       │  │
│  │                              │  │
│  │ ❤️ 128  💬 23  ↩️ 回复       │  │  ← 互动按钮
│  │ ├─ 👤 用户B: 我也这么觉得   │  │  ← 回复（折叠）
│  │ ├─ 👤 用户C: 小心回调       │  │
│  │ └─ 查看全部23条回复 >       │  │
│  └──────────────────────────────┘  │
│  ┌──────────────────────────────┐  │
│  │ 👤 用户D       5小时前       │  │
│  │ ┌────────────────────────┐   │  │
│  │ │ 💰 评论时价格: 2635.80  │   │  │
│  │ └────────────────────────┘   │  │
│  │ 今天波动不大，观望中...     │  │
│  │ ❤️ 56   💬 8   ↩️ 回复       │  │
│  └──────────────────────────────┘  │
└────────────────────────────────────┘
```

#### 4.4.3 核心功能：价格锚定评论系统

**功能设计理念**

当用户发布评论时，系统自动记录当时的实时价格，并在评论内容上方以特殊样式展示"评论时价格"标签。这让其他用户在阅读评论时能够理解评论者的市场语境，增强评论的参考价值。

**评论数据结构**

| 字段 | 类型 | 说明 |
|-----|------|------|
| comment_id | String | 评论唯一标识 |
| user_id | String | 评论用户ID |
| symbol | String | 品种代码 |
| content | String | 评论内容 |
| price_at_comment | Number | 评论时的实时价格 |
| timestamp | DateTime | 评论时间 |
| likes_count | Number | 点赞数 |
| replies_count | Number | 回复数 |
| parent_id | String | 父评论ID（如果是回复） |

**评论发布流程**

```
用户点击"发布"
      ↓
弹出评论输入框
      ↓
用户输入评论内容
      ↓
点击"发送"
      ↓
系统捕获当前实时价格
      ↓
创建评论记录（content + price_at_comment）
      ↓
发布成功，显示在评论列表
```

#### 4.4.4 评论区交互设计（参考小红书+X）

**评论列表布局（参考小红书）**

- 评论以卡片形式垂直排列
- 每条评论包含：头像、用户名、时间、价格标签、内容、互动栏
- 回复默认折叠显示，展示前2-3条
- 点击"查看全部X条回复"展开所有回复

**评论对话逻辑（参考X/Twitter）**

| 交互场景 | 行为描述 |
|---------|---------|
| 发布主评论 | 直接对当前价格发表观点 |
| 回复评论 | 点击"回复"按钮，进入回复模式 |
| 回复的回复 | 支持嵌套回复，形成对话线程 |
| @提及 | 回复时自动@被回复者 |
| 点赞 | 点击❤️图标，数量实时更新 |
| 查看对话 | 点击评论可展开完整对话线程 |

**回复展示规则**

```
主评论
├── 回复1（显示）
├── 回复2（显示）
├── 回复3（显示，如果≤3条）
└── "查看全部X条回复 >"（如果>3条）
```

#### 4.4.5 K线图表功能

**周期选项**

| 周期 | 说明 |
|-----|------|
| 分时 | 当日分时走势图 |
| 日K | 日K线图 |
| 周K | 周K线图 |
| 月K | 月K线图 |

**图表交互**

| 操作 | 响应 |
|-----|------|
| 左右滑动 | 查看历史K线 |
| 双指缩放 | 调整K线密度 |
| 长按 | 显示十字光标和详细数据 |
| 点击周期Tab | 切换K线周期 |

#### 4.4.6 交互说明

| 操作 | 响应 |
|-----|------|
| 点击返回 | 返回上一页 |
| 点击收藏 | 收藏/取消收藏该品种 |
| 点击"发布" | 弹出评论输入框 |
| 提交评论 | 捕获当前价格，发布评论 |
| 点击点赞 | 点赞数+1，按钮变红 |
| 点击回复 | 进入回复输入模式 |
| 点击评论 | 展开对话线程详情 |
| 下拉评论区 | 加载更多评论 |

#### 4.4.7 验收标准

- [ ] K线图表正常显示，支持4种周期切换
- [ ] K线支持滑动、缩放、长按交互
- [ ] 发布评论时自动记录当前价格
- [ ] 评论显示"评论时价格"标签
- [ ] 评论支持点赞、回复功能
- [ ] 回复支持嵌套对话
- [ ] 评论列表支持下拉加载更多

---

### 4.5 价格预测互动系统（核心功能）

#### 4.5.1 功能描述

价格预测互动系统是本产品的核心差异化功能之一，通过ABCD选项投票机制，让用户可以发起对价格走势的预测，邀请其他用户参与投票讨论。系统会自动验证预测结果，计算预测准确性，展示用户的前瞻性洞察能力。

**核心理念**
- 每个用户都有机会对价格走势发表看法
- 通过ABCD多选项投票形式，降低参与门槛，增强互动性
- 系统自动计算价格差值，验证预测准确性
- 形成良性互动氛围，激励有前瞻性的用户

**产品定位声明**
- 本功能仅为社区互动玩法，不构成任何投资建议
- 用户预测仅代表个人观点，不对任何投资决策负责
- 平台不涉及交易功能，无需交易资质

#### 4.5.2 预测投票页面布局

```
┌────────────────────────────────────────────────────────────────┐
│  ← 返回    伦敦金 XAU/USD  预测投票    ☆                       │
├────────────────────────────────────────────────────────────────┤
│         当前价格: 2658.50                                       │
│         ▲ +28.30 (+1.08%)     更新于 10:30:25                  │
├────────────────────────────────────────────────────────────────┤
│  [进行中] [已结束] [我发起的] [我参与的]                         │  ← Tab切换
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  🔥 热门预测                                     [发起预测 +]   │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │  👤 用户A · 预测达人 · 准确率78%           3小时后截止    │ │
│  │  ┌────────────────────────────────────────────────────┐  │ │
│  │  │ 💰 发起时价格: 2650.30                             │  │ │
│  │  └────────────────────────────────────────────────────┘  │ │
│  │                                                          │ │
│  │  📊 预测问题: 今晚8点前黄金价格走势如何？                 │ │
│  │                                                          │ │
│  │  ┌─────────────┐  ┌─────────────┐                       │ │
│  │  │ A. 涨超1%   │  │ B. 小幅上涨 │                       │ │
│  │  │   ████ 35% │  │   ██ 15%   │                       │ │
│  │  │   🔵 已选   │  │             │                       │ │
│  │  └─────────────┘  └─────────────┘                       │ │
│  │  ┌─────────────┐  ┌─────────────┐                       │ │
│  │  │ C. 横盘整理 │  │ D. 下跌     │                       │ │
│  │  │   ████ 30% │  │   ███ 20%  │                       │ │
│  │  └─────────────┘  └─────────────┘                       │ │
│  │                                                          │ │
│  │  👥 128人参与  💬 23条讨论  ⏰ 倒计时: 2:35:20           │ │
│  │                                                          │ │
│  │  [查看讨论] [分享预测]                                    │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │  👤 用户B                                  已结束 ✓       │ │
│  │  ┌────────────────────────────────────────────────────┐  │ │
│  │  │ 💰 发起: 2630.00 → 结果: 2658.50 (+1.08%)         │  │ │
│  │  │ ✅ 正确答案: A. 涨超1%                             │  │ │
│  │  └────────────────────────────────────────────────────┘  │ │
│  │                                                          │ │
│  │  📊 昨日黄金是否突破2650？                                │ │
│  │                                                          │ │
│  │  A. ✅ 突破 (正确)  68%  │  B. 不会突破  32%            │ │
│  │                                                          │ │
│  │  👥 256人参与  🎯 你的选择: A (正确✓)                    │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

#### 4.5.3 发起预测流程

```
┌────────────────────────────────────────────────────────────────┐
│  发起价格预测                                           [X]    │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  当前品种: 伦敦金 XAU/USD                                       │
│  当前价格: 2658.50 (将自动记录)                                 │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │  预测问题 (必填)                                         │ │
│  │  ┌────────────────────────────────────────────────────┐  │ │
│  │  │ 例如: 今天收盘价格会突破2660吗？                    │  │ │
│  │  └────────────────────────────────────────────────────┘  │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │  预测选项 (至少2个，最多4个)                              │ │
│  │                                                          │ │
│  │  A. [会突破2660              ] ✓                        │ │
│  │  B. [不会突破，维持横盘       ] ✓                        │ │
│  │  C. [下跌至2640以下          ] ✓                        │ │
│  │  D. [添加选项...            ]                           │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │  验证时间 (预测截止时间)                                  │ │
│  │                                                          │ │
│  │  [今天]  [12:00]  (距现在 1小时30分)                     │ │
│  │                                                          │ │
│  │  💡 验证时间到达后，系统将自动记录当时价格并公布结果       │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │  正确答案判定规则                                         │ │
│  │                                                          │ │
│  │  ○ 到达验证时间后我手动公布                              │ │
│  │  ● 系统根据价格自动判定（推荐）                          │ │
│  │                                                          │ │
│  │  系统判定规则:                                           │ │
│  │  验证时价格 ≥ 2660 → A正确                              │ │
│  │  2640 ≤ 价格 < 2660 → B正确                             │ │
│  │  价格 < 2640 → C正确                                    │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│                           [发起预测]                           │
│                                                                │
│  ⚠️ 免责声明: 本预测仅供社区互动娱乐，不构成任何投资建议。     │
└────────────────────────────────────────────────────────────────┘
```

#### 4.5.4 预测讨论区

用户可以在预测帖子下进行讨论，对发起人和其他参与者的观点进行回复互动。

```
┌────────────────────────────────────────────────────────────────┐
│  ← 返回    预测详情                                            │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  👤 用户A · 预测达人 · 历史准确率 78%                          │
│  ┌────────────────────────────────────────────────────────┐   │
│  │ 💰 发起时价格: 2650.30      ⏰ 截止: 今天 20:00         │   │
│  └────────────────────────────────────────────────────────┘   │
│                                                                │
│  📊 今晚8点前黄金价格走势如何？                                │
│                                                                │
│  我认为今天非农数据利好，金价有望冲击2660关口...               │
│                                                                │
│  [投票区域 - 同上]                                             │
│                                                                │
├────────────────────────────────────────────────────────────────┤
│  讨论区 (23条)                                        发表 +   │
├────────────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ 👤 用户B  选择了A  · 5分钟前                             │ │
│  │ ┌────────────────────────────────────────────────────┐  │ │
│  │ │ 💰 评论时价格: 2655.80                             │  │ │
│  │ └────────────────────────────────────────────────────┘  │ │
│  │ 同意！今天数据面确实利好，我也押A                        │ │
│  │                                                          │ │
│  │ ❤️ 28  💬 5  ↩️ 回复                                     │ │
│  │ ├─ 👤 用户A(发起人): 握手🤝                             │ │
│  │ ├─ 👤 用户C: 小心假突破，我选B                          │ │
│  │ └─ 查看全部5条回复 >                                     │ │
│  └──────────────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ 👤 用户D  选择了C  · 15分钟前                            │ │
│  │ ┌────────────────────────────────────────────────────┐  │ │
│  │ │ 💰 评论时价格: 2652.30                             │  │ │
│  │ └────────────────────────────────────────────────────┘  │ │
│  │ 我反而觉得会回调，美元指数在走强...                      │ │
│  │                                                          │ │
│  │ ❤️ 12  💬 3  ↩️ 回复                                     │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

#### 4.5.5 预测结果展示与验证

当预测到达验证时间后，系统自动记录当时价格，计算结果并展示。

```
┌────────────────────────────────────────────────────────────────┐
│  🎉 预测结果揭晓                                              │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  👤 用户A 的预测    ✅ 预测准确                                │
│                                                                │
│  ┌────────────────────────────────────────────────────────┐   │
│  │           价格变化验证                                   │   │
│  │                                                          │   │
│  │   发起时价格         验证时价格         价格差           │   │
│  │     2650.30    →      2662.50       +12.20 (+0.46%)    │   │
│  │                                                          │   │
│  │                       📈                                 │   │
│  │               ___●                                       │   │
│  │              /                                           │   │
│  │          ___/                                            │   │
│  │         ●                                                │   │
│  │        发起                  验证                        │   │
│  │       10:30                 20:00                       │   │
│  │                                                          │   │
│  └────────────────────────────────────────────────────────┘   │
│                                                                │
│  ┌────────────────────────────────────────────────────────┐   │
│  │  问题: 今晚8点前黄金价格走势如何？                        │   │
│  │                                                          │   │
│  │  ✅ A. 涨超1%         ░░░░░░░░░░ 已不满足(涨0.46%)      │   │
│  │  ✅ B. 小幅上涨 ✓正确  ████████░░ 68% (正确答案)         │   │
│  │     C. 横盘整理       ███░░░░░░░ 22%                     │   │
│  │     D. 下跌           █░░░░░░░░░ 10%                     │   │
│  │                                                          │   │
│  │  👥 参与人数: 256人   🎯 正确率: 68%                     │   │
│  └────────────────────────────────────────────────────────┘   │
│                                                                │
│  ┌────────────────────────────────────────────────────────┐   │
│  │  🏆 预测正确的用户 (174人)                               │   │
│  │                                                          │   │
│  │  👤 用户A(发起人)  👤 用户B  👤 用户F  👤 用户G ...      │   │
│  │                                                          │   │
│  │  [查看完整名单]                                          │   │
│  └────────────────────────────────────────────────────────┘   │
│                                                                │
│  [返回预测列表]  [发起新预测]  [分享战绩]                      │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

#### 4.5.6 预测数据模型

**预测投票数据结构**

| 字段 | 类型 | 说明 |
|-----|------|------|
| prediction_id | String | 预测唯一标识 |
| user_id | String | 发起用户ID |
| symbol_code | String | 品种代码 |
| question | String | 预测问题 |
| options | Array | 选项列表（A/B/C/D） |
| price_at_create | Decimal | 发起时价格 |
| price_at_verify | Decimal | 验证时价格（结果揭晓后填入）|
| verify_time | DateTime | 验证时间 |
| correct_option | String | 正确答案（A/B/C/D）|
| verify_rule | Enum | 验证规则（手动/自动）|
| auto_verify_conditions | JSON | 自动验证条件 |
| status | Enum | 状态（进行中/已结束/已取消）|
| participants_count | Int | 参与人数 |
| comments_count | Int | 讨论数 |
| created_at | DateTime | 创建时间 |

**用户投票记录**

| 字段 | 类型 | 说明 |
|-----|------|------|
| vote_id | String | 投票记录ID |
| prediction_id | String | 预测ID |
| user_id | String | 用户ID |
| selected_option | String | 选择的选项（A/B/C/D）|
| price_at_vote | Decimal | 投票时价格 |
| is_correct | Boolean | 是否正确（结果揭晓后更新）|
| voted_at | DateTime | 投票时间 |

**用户预测成绩**

| 字段 | 类型 | 说明 |
|-----|------|------|
| user_id | String | 用户ID |
| total_predictions | Int | 发起的预测总数 |
| total_participations | Int | 参与的预测总数 |
| correct_count | Int | 正确次数 |
| accuracy_rate | Decimal | 准确率（百分比）|
| streak_correct | Int | 连续正确次数 |
| max_streak | Int | 历史最高连胜 |
| prediction_score | Int | 预测积分 |
| rank_title | String | 称号（如：预测新手/预测达人/预测大师）|
| updated_at | DateTime | 更新时间 |

#### 4.5.7 准确性计算规则

**预测结果验证流程**

```
验证时间到达
      ↓
系统获取当前实时价格
      ↓
记录 price_at_verify
      ↓
计算价格差值: (verify_price - create_price) / create_price × 100%
      ↓
根据验证规则判定正确答案
      ↓
更新所有投票记录的 is_correct 字段
      ↓
更新参与用户的预测成绩
      ↓
推送结果通知给参与用户
```

**准确率计算公式**

```
用户准确率 = 预测正确次数 / 参与预测总数 × 100%

条件：参与预测 ≥ 10次 才计入排行榜
```

**预测积分规则**

| 行为 | 积分 |
|-----|------|
| 发起预测 | +5 |
| 参与投票 | +1 |
| 预测正确 | +10 |
| 预测错误 | +0 |
| 连续正确2次 | 额外+5 |
| 连续正确3次及以上 | 每次额外+10 |
| 发起的预测被100人参与 | 额外+20 |

**预测达人称号体系**

| 称号 | 条件 |
|-----|------|
| 预测新手 | 参与预测 < 10次 |
| 预测爱好者 | 参与 ≥ 10次，准确率 < 50% |
| 预测达人 | 参与 ≥ 30次，准确率 ≥ 60% |
| 预测专家 | 参与 ≥ 50次，准确率 ≥ 70% |
| 预测大师 | 参与 ≥ 100次，准确率 ≥ 75% |
| 预测宗师 | 参与 ≥ 200次，准确率 ≥ 80% |

#### 4.5.8 交互说明

| 操作 | 响应 |
|-----|------|
| 点击"发起预测" | 打开预测发起表单 |
| 选择投票选项 | 记录投票，更新投票比例显示 |
| 点击预测卡片 | 进入预测详情页 |
| 点击"查看讨论" | 展开讨论区 |
| 发表讨论 | 自动记录评论时价格 |
| 验证时间到达 | 系统自动验证并推送通知 |
| 点击"分享战绩" | 生成预测结果分享图 |
| 切换Tab | 筛选不同状态的预测 |

#### 4.5.9 验收标准

- [ ] 用户可正常发起预测，设置问题、选项和验证时间
- [ ] 预测选项支持2-4个选择
- [ ] 投票后实时更新投票比例
- [ ] 验证时间到达后系统自动记录价格并判定结果
- [ ] 正确计算价格差值并展示
- [ ] 用户预测成绩正确累计
- [ ] 准确率和积分正确计算
- [ ] 预测讨论区支持回复和点赞
- [ ] 每条讨论显示评论时价格
- [ ] 推送预测结果通知

---

### 4.6 讨论区

#### 4.6.1 功能描述

讨论区是社区内容聚合页面，展示热门话题、热门品种关注榜、热门评价榜单以及**预测达人榜**，帮助用户发现有价值的讨论内容和优秀的预测达人。

#### 4.6.2 页面布局

```
┌────────────────────────────────────────────────────────────────┐
│  [话题榜] [关注榜] [点赞榜] [预测榜]                            │  ← Tab切换
├────────────────────────────────────────────────────────────────┤
│                                                                │
│        === 话题榜Tab ===                                       │
│                                                                │
│  🔥 实时讨论话题Top榜单                                         │
├────────────────────────────────────────────────────────────────┤
│  1. #黄金突破2660#                                             │
│     📊 讨论数: 2.3k  🔥 热度: 98                               │
│                                                                │
│  2. #美联储降息预期#                                           │
│     📊 讨论数: 1.8k  🔥 热度: 92                               │
│                                                                │
│  3. #人民币汇率走势#                                           │
│     📊 讨论数: 1.2k  🔥 热度: 85                               │
│                                                                │
│  ... 更多话题 ...                                              │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│        === 关注榜Tab ===                                       │
│                                                                │
│  🏆 热门品种关注榜                                              │
├────────────────────────────────────────────────────────────────┤
│  1. 伦敦金 XAU/USD                                             │
│     👁️ 关注: 58.2k  📝 评论: 12.5k                            │
│                                                                │
│  2. 美元/人民币 USD/CNY                                        │
│     👁️ 关注: 45.6k  📝 评论: 8.9k                             │
│                                                                │
│  3. 伦敦银 XAG/USD                                             │
│     👁️ 关注: 32.1k  📝 评论: 6.2k                             │
│                                                                │
│  ... 更多品种 ...                                              │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│        === 点赞榜Tab ===                                       │
│                                                                │
│  👍 热门评价点赞榜                                              │
├────────────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ 👤 投资达人A                                              │ │
│  │ 💰 评论时价格: 2650.30                                   │ │
│  │ "黄金长期看涨，短期注意..."                               │ │
│  │ ❤️ 5.2k  💬 328                                          │ │
│  └──────────────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ 👤 外汇分析师B                                            │ │
│  │ 💰 评论时价格: 7.2380                                    │ │
│  │ "人民币汇率稳定，不必恐慌..."                             │ │
│  │ ❤️ 4.8k  💬 256                                          │ │
│  └──────────────────────────────────────────────────────────┘ │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│        === 预测榜Tab（新增）===                                 │
│                                                                │
│  🎯 预测达人榜                                                  │
├────────────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────────────┐ │
│  │  [准确率榜] [积分榜] [连胜榜] [活跃榜]                     │ │  ← 子Tab
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  === 准确率榜 ===                                              │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │  🥇 1. 预测大师A                                          │ │
│  │     称号: 预测宗师  准确率: 82%  参与: 256次              │ │
│  │     最近预测: 黄金突破2650 ✅                             │ │
│  │                                          [关注] [查看]    │ │
│  ├──────────────────────────────────────────────────────────┤ │
│  │  🥈 2. 黄金猎手B                                          │ │
│  │     称号: 预测大师  准确率: 78%  参与: 189次              │ │
│  │     最近预测: 人民币汇率走稳 ✅                           │ │
│  │                                          [关注] [查看]    │ │
│  ├──────────────────────────────────────────────────────────┤ │
│  │  🥉 3. 外汇观察者C                                        │ │
│  │     称号: 预测专家  准确率: 75%  参与: 156次              │ │
│  │     最近预测: 白银回调 ✅                                 │ │
│  │                                          [关注] [查看]    │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  === 连胜榜 ===                                                │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │  🔥 1. 神预测D        当前连胜: 12次 🔥                   │ │
│  │  🔥 2. 金银专家E      当前连胜: 9次                       │ │
│  │  🔥 3. 趋势追踪F      当前连胜: 8次                       │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  === 热门预测 ===                                              │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │  🔥 进行中预测TOP3                                        │ │
│  │                                                          │ │
│  │  1. "黄金今晚能否突破2680？" - 发起人A                    │ │
│  │     👥 358人参与  ⏰ 倒计时: 1:25:30                      │ │
│  │                                                          │ │
│  │  2. "人民币汇率下周走势？" - 发起人B                      │ │
│  │     👥 286人参与  ⏰ 倒计时: 3天                          │ │
│  │                                                          │ │
│  │  3. "白银能否重回30？" - 发起人C                          │ │
│  │     👥 198人参与  ⏰ 倒计时: 5:45:00                      │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

#### 4.6.3 功能规则

**话题榜**

| 字段 | 说明 |
|-----|------|
| 话题标签 | #话题名称# 格式 |
| 讨论数 | 包含该话题的评论数量 |
| 热度值 | 综合讨论数、参与人数、时效性计算 |
| 排序规则 | 按热度值降序排列 |

**关注榜**

| 字段 | 说明 |
|-----|------|
| 品种名称 | 品种中文名+代码 |
| 关注人数 | 收藏该品种的用户数 |
| 评论数 | 该品种详情页的评论总数 |
| 排序规则 | 按关注人数降序排列 |

**点赞榜**

| 字段 | 说明 |
|-----|------|
| 评论卡片 | 同详情页评论卡片样式 |
| 排序规则 | 按点赞数降序排列 |
| 时间范围 | 默认显示24小时内热门评论 |

**预测榜（新增）**

| 子榜单 | 说明 |
|-------|------|
| 准确率榜 | 按预测准确率排序（需参与≥10次） |
| 积分榜 | 按预测积分排序 |
| 连胜榜 | 按当前连续正确次数排序 |
| 活跃榜 | 按近7天参与预测次数排序 |

**预测达人卡片字段**

| 字段 | 说明 |
|-----|------|
| 用户头像+昵称 | 用户基本信息 |
| 称号 | 预测新手/达人/专家/大师/宗师 |
| 准确率 | 正确预测比例 |
| 参与次数 | 累计参与预测数 |
| 最近预测 | 最新一条预测结果 |
| 当前连胜 | 连续正确次数（连胜榜） |

**热门预测规则**

| 字段 | 说明 |
|-----|------|
| 排序规则 | 按参与人数降序 |
| 筛选条件 | 仅显示进行中的预测 |
| 展示数量 | Top 3-5 |

#### 4.6.4 交互说明

| 操作 | 响应 |
|-----|------|
| 点击Tab | 切换榜单类型 |
| 点击话题 | 进入话题详情页（显示相关评论） |
| 点击品种 | 进入该品种详情页 |
| 点击评论卡片 | 进入评论所属品种的详情页 |
| 点击预测达人 | 进入该用户的预测主页 |
| 点击"关注" | 关注该预测达人 |
| 点击热门预测 | 进入预测详情页参与投票 |
| 下拉列表 | 加载更多内容 |

#### 4.6.5 验收标准

- [ ] 四个Tab正确切换
- [ ] 话题榜显示热门话题和热度
- [ ] 关注榜显示品种关注和评论数据
- [ ] 点赞榜显示热门评论（含价格标签）
- [ ] 预测榜显示各维度排行
- [ ] 预测达人卡片信息完整
- [ ] 热门预测列表实时更新
- [ ] 各榜单点击跳转正确

---

### 4.7 个人中心

#### 4.7.1 功能描述

个人中心是用户管理页面，提供用户资料修改、账号绑定、偏好设置、**预测成绩展示**等功能。需要登录后才能访问完整功能。

#### 4.7.2 页面布局

**未登录状态**

```
┌────────────────────────────────────┐
│                                    │
│           👤 点击登录              │
│                                    │
│   ┌─────────────────────────────┐  │
│   │    📱 手机号登录             │  │
│   └─────────────────────────────┘  │
│   ┌─────────────────────────────┐  │
│   │    🔵 Google登录            │  │
│   └─────────────────────────────┘  │
│   ┌─────────────────────────────┐  │
│   │    🍎 Apple登录             │  │
│   └─────────────────────────────┘  │
│                                    │
└────────────────────────────────────┘
```

**已登录状态**

```
┌────────────────────────────────────────────────────────────────┐
│  ┌────┐                                                        │
│  │ 👤 │  用户昵称                                              │  ← 用户信息卡片
│  └────┘  用户ID: 12345678                                      │
├────────────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────────────┐ │
│  │  🎯 我的预测成绩                                          │ │  ← 新增预测成绩卡片
│  │                                                          │ │
│  │  称号: 预测达人 🏅                                        │ │
│  │                                                          │ │
│  │  ┌────────────┐ ┌────────────┐ ┌────────────┐           │ │
│  │  │ 参与预测   │ │ 准确率     │ │ 当前连胜   │           │ │
│  │  │    68次   │ │   72%     │ │    5次    │           │ │
│  │  └────────────┘ └────────────┘ └────────────┘           │ │
│  │                                                          │ │
│  │  积分: 1,280  排名: #156                    [查看详情 >] │ │
│  └──────────────────────────────────────────────────────────┘ │
├────────────────────────────────────────────────────────────────┤
│  个人资料                                                  >   │
├────────────────────────────────────────────────────────────────┤
│  账号绑定                                                  >   │
├────────────────────────────────────────────────────────────────┤
│  偏好设置                                                      │
│  ├─ 涨跌颜色    [红涨绿跌 ▼]                                  │  ← 下拉选择
│  └─ 语言        [简体中文 ▼]                                  │
├────────────────────────────────────────────────────────────────┤
│  我的收藏                                                  >   │
├────────────────────────────────────────────────────────────────┤
│  我的评论                                                  >   │
├────────────────────────────────────────────────────────────────┤
│  我的预测记录                                              >   │  ← 新增
├────────────────────────────────────────────────────────────────┤
│  关于我们                                                  >   │
├────────────────────────────────────────────────────────────────┤
│  退出登录                                                      │
└────────────────────────────────────────────────────────────────┘
```

#### 4.7.3 我的预测记录页面（新增）

```
┌────────────────────────────────────────────────────────────────┐
│  ← 返回    我的预测记录                                        │
├────────────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────────────┐ │
│  │  🎯 预测成绩总览                                          │ │
│  │                                                          │ │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐   │ │
│  │  │ 发起预测 │ │ 参与预测 │ │ 正确次数 │ │ 准确率   │   │ │
│  │  │   12次  │ │   68次  │ │   49次  │ │   72%   │   │ │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘   │ │
│  │                                                          │ │
│  │  当前连胜: 5次 🔥   历史最高连胜: 8次                     │ │
│  │  预测积分: 1,280    全站排名: #156                       │ │
│  └──────────────────────────────────────────────────────────┘ │
├────────────────────────────────────────────────────────────────┤
│  [我发起的] [我参与的] [进行中] [已结束]                        │  ← Tab筛选
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │  📊 黄金今晚能否突破2660？                    进行中 ⏰   │ │
│  │  发起时价格: 2650.30                                      │ │
│  │  我的选择: A. 会突破                                      │ │
│  │  当前投票: A-35% B-40% C-15% D-10%                       │ │
│  │  ⏰ 倒计时: 2:35:20                                       │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │  📊 人民币汇率下周走势？                      已结束 ✅   │ │
│  │  发起: 7.2380 → 结果: 7.2150 (-0.32%)                    │ │
│  │  我的选择: B. 小幅升值 ✅ 正确                            │ │
│  │  正确答案: B (68%用户选择)                                │ │
│  │  +10积分                                                  │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │  📊 白银能否重回30？                          已结束 ❌   │ │
│  │  发起: 29.50 → 结果: 28.80 (-2.37%)                      │ │
│  │  我的选择: A. 能突破30 ❌ 错误                            │ │
│  │  正确答案: C. 下跌 (52%用户选择)                          │ │
│  │  +0积分                                                   │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

#### 4.7.4 功能规则

**登录方式**

| 登录方式 | 说明 |
|---------|------|
| 手机号登录 | 支持短信验证码登录，作为默认登录方式 |
| Google登录 | OAuth第三方登录 |
| Apple登录 | Sign in with Apple |
| 微信绑定 | 绑定后可通过微信登录（非首次登录方式）|

**账号绑定管理**

| 绑定项 | 操作 |
|-------|------|
| 手机号 | 绑定/更换手机号 |
| Google | 绑定/解绑 |
| Apple | 绑定/解绑 |
| 微信 | 绑定/解绑 |

**偏好设置**

| 设置项 | 选项 |
|-------|------|
| 涨跌颜色 | 红涨绿跌（默认）/ 绿涨红跌 |
| 语言 | 简体中文 / 繁体中文 / English |

**语言选择时机**
- 新用户注册流程中可选择语言
- 已注册用户可在设置中随时切换

#### 4.7.5 个人资料修改

| 字段 | 可编辑 | 说明 |
|-----|-------|------|
| 头像 | ✅ | 支持从相册选择或拍照 |
| 昵称 | ✅ | 2-20个字符 |
| 简介 | ✅ | 最多100个字符 |
| 用户ID | ❌ | 系统自动生成，不可修改 |

#### 4.7.6 交互说明

| 操作 | 响应 |
|-----|------|
| 点击登录入口 | 进入登录页面 |
| 选择登录方式 | 执行对应登录流程 |
| 点击个人资料 | 进入资料编辑页面 |
| 点击账号绑定 | 进入账号绑定管理页面 |
| 点击预测成绩卡片 | 进入我的预测记录页面 |
| 点击"我的预测记录" | 进入预测记录详情页 |
| 切换涨跌颜色 | 全局涨跌颜色立即生效 |
| 切换语言 | 弹出确认框，确认后重启App生效 |
| 点击退出登录 | 弹出确认框，确认后退出 |

#### 4.7.7 验收标准

- [ ] 未登录状态显示登录入口
- [ ] 支持手机号、Google、Apple三种登录方式
- [ ] 支持微信绑定/解绑
- [ ] 个人资料可正常编辑保存
- [ ] 预测成绩卡片正确显示
- [ ] 我的预测记录页面正常展示
- [ ] 预测记录支持Tab筛选
- [ ] 涨跌颜色切换全局生效
- [ ] 语言切换正确生效
- [ ] 退出登录正常工作

---

### 4.8 管理后台（Admin Dashboard）

#### 4.8.1 功能概述

管理后台是供运营人员和管理员使用的Web端管理系统，用于监控应用运行状态、管理用户和内容、配置系统参数等。

**访问权限**

| 角色 | 权限范围 |
|-----|---------|
| 超级管理员 | 所有功能 |
| 运营管理员 | 用户管理、内容管理、启动页管理 |
| 技术管理员 | API状态、数据源切换、系统配置 |
| 客服人员 | 用户查询、评论审核（只读+审核）|

---

#### 4.8.2 首页统计概览

**页面布局**

```
┌─────────────────────────────────────────────────────────────────────┐
│  📊 数据概览                                    今日 | 本周 | 本月  │
├─────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐   │
│  │ 实时在线    │ │ 今日注册    │ │ 累计用户    │ │ 今日评论    │   │
│  │   1,234    │ │    156     │ │  58,923    │ │    892     │   │
│  │ 🟢 正常     │ │  ▲ +12%   │ │  ▲ +2.3%  │ │  ▲ +8%    │   │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘   │
├─────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │              📈 用户活跃时间段分布（24小时折线图）            │   │
│  │  ▓                                                          │   │
│  │  ▓     ▓▓▓                              ▓▓▓▓▓              │   │
│  │  ▓▓    ▓▓▓▓▓                          ▓▓▓▓▓▓▓▓            │   │
│  │  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓    │   │
│  │  0  2  4  6  8  10 12 14 16 18 20 22 24                    │   │
│  └─────────────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────────────┤
│  ┌──────────────────────────┐  ┌──────────────────────────────┐   │
│  │ 📱 各端口在线分布         │  │ 📊 各端口注册统计            │   │
│  │                          │  │                              │   │
│  │  iOS      : 523 (42%)   │  │  iOS      : 68 (44%)        │   │
│  │  Android  : 689 (56%)   │  │  Android  : 82 (53%)        │   │
│  │  Web      : 22  (2%)    │  │  Web      : 6  (3%)         │   │
│  │                          │  │                              │   │
│  │  [饼图]                   │  │  [饼图]                      │   │
│  └──────────────────────────┘  └──────────────────────────────┘   │
├─────────────────────────────────────────────────────────────────────┤
│  ┌──────────────────────────┐  ┌──────────────────────────────┐   │
│  │ 💬 评论数据统计           │  │ 🔥 热门品种Top5              │   │
│  │                          │  │                              │   │
│  │  今日新增评论  : 892     │  │  1. XAU/USD   2,341条       │   │
│  │  今日新增回复  : 1,256   │  │  2. USD/CNY   1,892条       │   │
│  │  今日点赞数    : 3,421   │  │  3. XAG/USD   1,234条       │   │
│  │  待审核评论    : 23      │  │  4. Au(T+D)     986条       │   │
│  │  已屏蔽评论    : 8       │  │  5. EUR/USD     756条       │   │
│  └──────────────────────────┘  └──────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
```

**统计数据指标**

| 数据项 | 说明 | 更新频率 |
|-------|------|---------|
| 实时在线用户数 | 当前WebSocket连接数 | 实时 |
| 今日注册用户数 | 今日0点至今新增注册 | 实时 |
| 累计用户数 | 平台总注册用户数 | 每小时 |
| 今日评论数 | 今日新增评论（含回复）| 实时 |
| 各端口在线分布 | iOS/Android/Web在线占比 | 实时 |
| 各端口注册统计 | iOS/Android/Web注册占比 | 每小时 |
| 用户活跃时间段 | 24小时活跃用户分布折线图 | 每小时 |
| 热门品种排行 | 按评论数排序的品种Top榜 | 每小时 |

**数据导出**
- 支持导出为Excel/CSV
- 支持自定义时间范围
- 支持按端口筛选

---

#### 4.8.3 启动页管理

**功能描述**

管理员可以上传和配置App启动页图片，配置后推送到用户端，用户下次启动App时展示新的启动页。

**页面布局**

```
┌─────────────────────────────────────────────────────────────────────┐
│  🖼️ 启动页管理                                    [+ 新增启动页]    │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  当前生效启动页                                                      │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  ┌────────┐                                                 │   │
│  │  │        │  名称: 2025新年活动启动页                        │   │
│  │  │ [预览] │  状态: 🟢 生效中                                 │   │
│  │  │        │  生效时间: 2025-12-20 00:00 ~ 2026-01-05 23:59  │   │
│  │  └────────┘  推送状态: ✅ 已推送 (2025-12-20 00:05)          │   │
│  │              覆盖率: iOS 98.2% | Android 97.5%              │   │
│  │                                          [编辑] [下线]       │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  启动页列表                                                         │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  名称          状态      生效时间              操作          │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │  新年活动      🟢生效中   12-20 ~ 01-05        编辑 | 下线   │   │
│  │  默认启动页    ⏸️待命     长期                 编辑 | 上线   │   │
│  │  双十一活动    ⚫已结束   11-01 ~ 11-15        查看 | 删除   │   │
│  │  国庆活动      ⚫已结束   09-28 ~ 10-08        查看 | 删除   │   │
│  └─────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
```

**启动页配置项**

| 配置项 | 说明 |
|-------|------|
| 启动页名称 | 内部管理名称 |
| iOS图片 | 支持多尺寸适配（1x/2x/3x）|
| Android图片 | 支持多分辨率适配 |
| 生效时间段 | 开始时间 ~ 结束时间 |
| 跳过按钮 | 显示/隐藏，跳过延迟秒数（3-5秒）|
| 点击跳转 | 可配置跳转链接（如活动页面）|
| 推送策略 | 立即推送 / 定时推送 |

**推送机制**
- 管理员点击"上线"后，系统通过静默推送通知客户端
- 客户端收到通知后，后台下载新启动页图片
- 用户下次冷启动App时展示新启动页
- 支持查看推送进度和覆盖率

---

#### 4.8.4 数据交互管理

##### 4.8.4.1 API状态监控

**页面布局**

```
┌─────────────────────────────────────────────────────────────────────┐
│  🔌 API状态监控                           自动刷新: [开] 每30秒     │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  服务状态总览                                                        │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐   │
│  │ API服务     │ │ WebSocket   │ │ 数据库      │ │ Redis缓存   │   │
│  │ 🟢 正常     │ │ 🟢 正常     │ │ 🟢 正常     │ │ 🟢 正常     │   │
│  │ 响应: 45ms │ │ 连接: 1234 │ │ 响应: 12ms │ │ 命中: 96%  │   │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘   │
│                                                                     │
│  API接口状态                                    [筛选: 全部状态 ▼]   │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  接口路径              状态    响应时间   调用次数   错误率   │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │  /api/v1/quotes/realtime   🟢   32ms     12.5k/h    0.01%  │   │
│  │  /api/v1/comments          🟢   48ms      2.3k/h    0.02%  │   │
│  │  /api/v1/auth/login        🟢   125ms     456/h     0.1%   │   │
│  │  /api/v1/exchange/rates    🟡   520ms     1.2k/h    0.5%   │   │
│  │  /api/v1/ws/quotes         🟢   -         1234连接   0%     │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  [查看执行日志]  [查看错误日志]                                      │
└─────────────────────────────────────────────────────────────────────┘
```

**日志查看**

```
┌─────────────────────────────────────────────────────────────────────┐
│  📋 错误日志                    时间范围: [最近1小时 ▼]  [导出]     │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ 🔴 ERROR  2025-12-25 14:32:15                               │   │
│  │ 接口: /api/v1/quotes/realtime                               │   │
│  │ 错误码: 503                                                  │   │
│  │ 错误信息: 行情数据源连接超时                                  │   │
│  │ 详情: 第三方API "provider_a" 响应超时(>5000ms)               │   │
│  │ 影响: 约 23 个请求返回降级数据                               │   │
│  │ 建议操作: 检查数据源状态或切换备用数据源                      │   │
│  │                                               [查看详情]     │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ 🟡 WARN   2025-12-25 14:28:03                               │   │
│  │ 接口: /api/v1/auth/login                                    │   │
│  │ 错误码: 429                                                  │   │
│  │ 错误信息: 请求频率超限                                       │   │
│  │ 详情: IP 123.45.67.89 在60秒内请求了 52 次登录接口           │   │
│  │ 建议操作: 可能存在恶意请求，建议关注                         │   │
│  └─────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
```

**错误码对照表（自然语言说明）**

| 错误码 | 状态 | 自然语言说明 | 建议操作 |
|-------|------|-------------|---------|
| 200 | ✅ 成功 | 请求成功 | - |
| 400 | ⚠️ 警告 | 请求参数有误，客户端发送的数据格式不正确 | 检查客户端代码 |
| 401 | ⚠️ 警告 | 用户未登录或登录已过期 | 正常现象，引导重新登录 |
| 403 | ⚠️ 警告 | 没有权限访问该资源 | 检查权限配置 |
| 404 | ⚠️ 警告 | 请求的资源不存在 | 检查请求路径 |
| 429 | ⚠️ 警告 | 请求太频繁，已被限流 | 关注是否有异常请求 |
| 500 | 🔴 错误 | 服务器内部错误 | 立即查看详细日志 |
| 502 | 🔴 错误 | 网关错误，上游服务不可用 | 检查服务部署状态 |
| 503 | 🔴 错误 | 服务暂时不可用 | 检查服务器负载或依赖服务 |
| 504 | 🔴 错误 | 请求超时，服务器响应太慢 | 检查服务性能或网络 |

##### 4.8.4.2 商业API数据源切换

**功能描述**

支持配置多个行情数据源，可随时切换主数据源，确保行情数据的稳定性和连续性。

**页面布局**

```
┌─────────────────────────────────────────────────────────────────────┐
│  📡 行情数据源管理                                  [+ 添加数据源]   │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  当前主数据源: Provider A (万得数据)                                 │
│                                                                     │
│  数据源列表                                                         │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  名称              状态    延迟    覆盖品种   优先级   操作   │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │  Provider A        🟢正常   45ms    全部      1(主)   [切换] │   │
│  │  (万得数据)        API Key: ****5678                        │   │
│  │                    最后心跳: 2秒前                           │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │  Provider B        🟢正常   62ms    贵金属    2(备)   [切换] │   │
│  │  (某金融数据)      API Key: ****1234                        │   │
│  │                    最后心跳: 3秒前                           │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │  Provider C        🟡延迟   520ms   外汇      3(备)   [切换] │   │
│  │  (汇率数据源)      API Key: ****9012                        │   │
│  │                    最后心跳: 15秒前 ⚠️                       │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  切换策略                                                           │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  ○ 手动切换 - 仅管理员手动操作时切换                         │   │
│  │  ● 自动故障转移 - 主数据源异常时自动切换到备用源              │   │
│  │    └─ 触发条件: 连续 [3] 次请求失败 或 延迟超过 [1000] ms    │   │
│  │    └─ 自动恢复: 主数据源恢复正常后 [5] 分钟自动切回          │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                         [保存配置]   │
└─────────────────────────────────────────────────────────────────────┘
```

**数据源切换操作**

| 操作 | 说明 |
|-----|------|
| 切换为主数据源 | 下拉选择后确认，立即生效 |
| 测试连接 | 发送测试请求验证数据源可用性 |
| 编辑配置 | 修改API Key、接口地址等 |
| 禁用/启用 | 临时禁用某个数据源 |

##### 4.8.4.3 统一错误处理配置

```
┌─────────────────────────────────────────────────────────────────────┐
│  ⚙️ 客户端错误提示配置                                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  当客户端遇到以下错误时，显示对应的友好提示：                         │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  错误场景              客户端显示文案                        │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │  网络连接失败          "网络连接不稳定，请检查网络后重试"     │   │
│  │  请求超时              "服务器响应较慢，请稍后再试"          │   │
│  │  行情数据加载失败       "行情数据加载中，请稍候..."          │   │
│  │  登录失败              "登录失败，请检查账号密码"            │   │
│  │  评论发送失败          "评论发送失败，请重试"                │   │
│  │  服务器维护中          "系统维护中，预计 XX:XX 恢复"         │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  加载状态文案                                                       │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  行情加载中            "正在获取最新行情..."                 │   │
│  │  评论加载中            "正在加载评论..."                     │   │
│  │  图表加载中            "正在绘制K线图..."                    │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                         [保存配置]   │
└─────────────────────────────────────────────────────────────────────┘
```

---

#### 4.8.5 多语言支持管理

**功能描述**

管理App支持的多语言内容，支持在线编辑翻译文案，新增语言后可热更新到客户端。

**页面布局**

```
┌─────────────────────────────────────────────────────────────────────┐
│  🌐 多语言管理                                      [+ 新增语言]    │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  已支持语言                                                         │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  语言          代码      翻译进度    状态     操作           │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │  🇨🇳 简体中文   zh_CN     100%       🟢已上线  编辑 | 导出   │   │
│  │  🇺🇸 English   en_US     100%       🟢已上线  编辑 | 导出   │   │
│  │  🇭🇰 繁體中文   zh_TW     98%        🟢已上线  编辑 | 导出   │   │
│  │  🇯🇵 日本語    ja_JP     95%        🟢已上线  编辑 | 导出   │   │
│  │  🇰🇷 한국어    ko_KR     45%        🟡开发中  编辑 | 导出   │   │
│  │  🇪🇸 Español  es_ES     0%         ⚫未开始  编辑 | 导出   │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

**翻译编辑界面**

```
┌─────────────────────────────────────────────────────────────────────┐
│  🇯🇵 日本語 翻译编辑                搜索: [________]  [保存] [发布] │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  分类: [全部 ▼]  状态: [未翻译优先 ▼]                               │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  Key                   简体中文(参考)      日本語           │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │  home.title            首页               ホーム            │   │
│  │  market.gold           黄金               ゴールド          │   │
│  │  market.silver         白银               シルバー          │   │
│  │  exchange.calculator   汇率计算器          為替計算機        │   │
│  │  comment.post          发布评论           コメントを投稿     │   │
│  │  comment.price_at      评论时价格          投稿時の価格      │   │
│  │  error.network         网络连接失败        ネットワークエラー │   │
│  │  ⚠️ profile.settings   设置               [未翻译]          │   │
│  │  ⚠️ profile.logout     退出登录           [未翻译]          │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  💡 点击单元格可直接编辑翻译                                         │
│                                                                     │
│  [导入Excel]  [导出Excel]  [AI批量翻译]                              │
└─────────────────────────────────────────────────────────────────────┘
```

**多语言数据结构**

| 字段 | 说明 |
|-----|------|
| key | 翻译键名，如 "home.title" |
| category | 分类，如 "首页"、"行情"、"评论" |
| zh_CN | 简体中文（基准语言）|
| en_US | 英语 |
| zh_TW | 繁体中文 |
| ja_JP | 日语 |
| ... | 其他语言 |

**新增语言流程**

1. 点击"新增语言"，选择语言代码和名称
2. 系统自动创建该语言的翻译条目（初始为空）
3. 可选择"AI批量翻译"自动填充初始翻译
4. 人工审核和修正翻译
5. 翻译进度达标后可"发布"上线
6. 客户端下次启动时热更新语言包

---

#### 4.8.6 用户管理

##### 4.8.6.1 用户列表管理

**页面布局**

```
┌─────────────────────────────────────────────────────────────────────┐
│  👥 用户管理                                                        │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  搜索: [用户ID/手机号/邮箱/昵称___________]  [搜索]                  │
│                                                                     │
│  筛选: 注册时间 [全部 ▼]  注册渠道 [全部 ▼]  状态 [全部 ▼]           │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  用户信息              注册方式    绑定账号   状态    操作   │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │  👤 投资达人A                                               │   │
│  │  ID: U12345678                                              │   │
│  │  注册: 2025-06-15      📱手机号    📱✓ 🔵✓ 🍎✓ 💬✓           │   │
│  │  最近活跃: 2小时前     iOS         正常      [详情] [禁用]   │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │  👤 外汇小白                                                │   │
│  │  ID: U12345679                                              │   │
│  │  注册: 2025-08-20      🔵Google    📱✗ 🔵✓ 🍎✗ 💬✗           │   │
│  │  最近活跃: 3天前       Android     正常      [详情] [禁用]   │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │  👤 违规用户X                                               │   │
│  │  ID: U12345680                                              │   │
│  │  注册: 2025-09-10      🍎Apple     📱✓ 🔵✗ 🍎✓ 💬✗           │   │
│  │  最近活跃: 已禁用      iOS         🔴已禁用  [详情] [解禁]   │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  绑定账号图例: 📱手机号  🔵Google  🍎Apple  💬微信                    │
│                                                                     │
│  共 58,923 个用户  |  < 1 2 3 ... 100 >                             │
└─────────────────────────────────────────────────────────────────────┘
```

**用户详情页**

```
┌─────────────────────────────────────────────────────────────────────┐
│  👤 用户详情: 投资达人A                              [返回列表]      │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  基本信息                                                           │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  ┌────────┐                                                 │   │
│  │  │ [头像] │  昵称: 投资达人A                                │   │
│  │  └────────┘  用户ID: U12345678                              │   │
│  │              简介: 专注贵金属投资10年                        │   │
│  │              注册时间: 2025-06-15 14:30:25                  │   │
│  │              注册设备: iPhone 15 Pro / iOS 17.2             │   │
│  │              注册IP: 123.45.67.89 (广东省深圳市)            │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  账号绑定                                                           │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  📱 手机号: 138****8888      绑定于 2025-06-15              │   │
│  │  🔵 Google: user@gmail.com  绑定于 2025-06-20              │   │
│  │  🍎 Apple:  ****@icloud.com 绑定于 2025-06-15              │   │
│  │  💬 微信:   已绑定           绑定于 2025-07-01              │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  活跃数据                                                           │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  最近登录: 2025-12-25 10:30:15                              │   │
│  │  累计登录: 256 天                                           │   │
│  │  发布评论: 128 条                                           │   │
│  │  获得点赞: 3,421 次                                         │   │
│  │  收藏品种: 8 个                                             │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  操作记录                                                           │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  2025-12-25 10:30  登录 (iOS)                               │   │
│  │  2025-12-24 22:15  发布评论 (XAU/USD)                       │   │
│  │  2025-12-24 21:00  收藏品种 (EUR/USD)                       │   │
│  │  ...                                                        │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  [查看该用户所有评论]  [禁用账号]  [重置密码]                         │
└─────────────────────────────────────────────────────────────────────┘
```

##### 4.8.6.2 评论内容管理

**页面布局**

```
┌─────────────────────────────────────────────────────────────────────┐
│  💬 评论管理                                                        │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  [全部评论]  [待审核 (23)]  [已屏蔽]  [已删除]                        │
│                                                                     │
│  搜索: [用户/内容关键词___________]  品种: [全部 ▼]  时间: [全部 ▼]   │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  ☑️ 全选     批量操作: [屏蔽 ▼]  [执行]                       │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │                                                             │   │
│  │  ☐ 评论ID: C123456                      2025-12-25 10:30   │   │
│  │    👤 投资达人A  |  品种: XAU/USD  |  💰 2650.30            │   │
│  │    ┌─────────────────────────────────────────────────────┐ │   │
│  │    │ 感觉要突破2660了，准备加仓！                         │ │   │
│  │    └─────────────────────────────────────────────────────┘ │   │
│  │    ❤️ 128  💬 23                     [通过] [屏蔽] [删除]   │   │
│  │                                                             │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │  ☐ 评论ID: C123457  ⚠️待审核            2025-12-25 10:25   │   │
│  │    👤 新用户B  |  品种: USD/CNY  |  💰 7.2456              │   │
│  │    ┌─────────────────────────────────────────────────────┐ │   │
│  │    │ [系统检测到敏感词]                                   │ │   │
│  │    │ 这个价格太****了，肯定要跌！                         │ │   │
│  │    └─────────────────────────────────────────────────────┘ │   │
│  │    ❤️ 0  💬 0                       [通过] [屏蔽] [删除]    │   │
│  │                                                             │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │  ☐ 评论ID: C123458  🔴已屏蔽            2025-12-24 18:00   │   │
│  │    👤 违规用户X  |  品种: XAG/USD  |  💰 30.25             │   │
│  │    ┌─────────────────────────────────────────────────────┐ │   │
│  │    │ [已屏蔽] 广告内容：加我微信XXX带你赚钱                │ │   │
│  │    └─────────────────────────────────────────────────────┘ │   │
│  │    屏蔽原因: 广告引流                   [恢复] [删除]       │   │
│  │                                                             │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  共 12,543 条评论  |  < 1 2 3 ... 500 >                             │
└─────────────────────────────────────────────────────────────────────┘
```

**评论管理操作**

| 操作 | 说明 | 用户端表现 |
|-----|------|----------|
| 通过 | 审核通过，正常显示 | 正常显示 |
| 屏蔽 | 隐藏评论，不删除数据 | 显示"该评论已被屏蔽" |
| 删除 | 软删除，可恢复 | 不显示 |
| 恢复 | 恢复已屏蔽/已删除的评论 | 恢复显示 |
| 彻底删除 | 硬删除，不可恢复 | 不显示 |

**屏蔽原因选项**

- 广告引流
- 敏感词汇
- 人身攻击
- 虚假信息
- 垃圾内容
- 其他（填写原因）

**自动审核规则**

| 规则 | 触发条件 | 处理方式 |
|-----|---------|---------|
| 敏感词检测 | 包含预设敏感词 | 进入待审核队列 |
| 新用户限制 | 注册<24小时的用户首次评论 | 进入待审核队列 |
| 频率限制 | 1分钟内发布>3条评论 | 进入待审核队列 |
| 重复内容 | 与近期评论重复度>80% | 自动屏蔽 |
| 广告检测 | 包含微信号/QQ号/链接 | 进入待审核队列 |

---

#### 4.8.7 管理后台验收标准

- [ ] 首页统计数据实时更新，数值准确
- [ ] 用户活跃时间段折线图正确显示
- [ ] 各端口在线/注册数据分类统计正确
- [ ] 启动页上传、配置、推送功能正常
- [ ] API状态监控实时刷新
- [ ] 执行日志和错误日志记录完整，可查询导出
- [ ] 数据源切换功能正常，支持自动故障转移
- [ ] 多语言编辑、新增、发布功能正常
- [ ] 用户搜索、筛选、详情查看正常
- [ ] 评论审核、屏蔽、删除功能正常
- [ ] 批量操作功能正常
- [ ] 权限控制正确，不同角色看到对应功能

---

## 5. 非功能需求

### 5.1 性能要求

| 指标 | 要求 |
|-----|------|
| 首页加载时间 | ≤ 2秒 |
| 行情数据刷新间隔 | ≤ 5秒 |
| K线图渲染时间 | ≤ 1秒 |
| 评论加载时间 | ≤ 1秒（首屏20条）|
| API响应时间 | ≤ 500ms |

### 5.2 兼容性要求

| 平台 | 最低版本 |
|-----|---------|
| iOS | iOS 13.0+ |
| Android | Android 8.0+ (API 26) |

### 5.3 安全性要求

| 安全项 | 措施 |
|-------|------|
| 数据传输 | 全站HTTPS |
| 用户认证 | JWT Token机制 |
| 敏感数据 | 脱敏存储 |
| 评论审核 | 接入内容安全服务 |

### 5.4 可用性要求

| 指标 | 要求 |
|-----|------|
| 系统可用性 | ≥ 99.5% |
| 行情数据准确性 | 与数据源一致 |

---

## 6. 数据埋点

### 6.1 关键页面埋点

| 页面 | 事件名 | 触发时机 | 关键参数 |
|-----|-------|---------|---------|
| 首页 | home_view | 页面加载 | - |
| 首页 | card_click | 点击行情卡片 | symbol |
| 行情页 | market_view | 页面加载 | category |
| 汇率页 | exchange_view | 页面加载 | - |
| 汇率页 | calculator_use | 使用计算器 | from_currency, to_currency |
| 详情页 | detail_view | 页面加载 | symbol |
| 详情页 | kline_switch | 切换K线周期 | period |
| 详情页 | comment_post | 发布评论 | symbol, price_at_comment |
| 详情页 | comment_like | 点赞评论 | comment_id |
| 详情页 | comment_reply | 回复评论 | comment_id |
| 讨论区 | community_view | 页面加载 | tab_type |
| 个人中心 | profile_view | 页面加载 | is_logged_in |
| 登录 | login_attempt | 尝试登录 | login_type |
| 登录 | login_success | 登录成功 | login_type |

### 6.2 核心指标

**北极星指标**
- DAU（日活跃用户数）

**一级指标**
- 用户留存率（次日/7日/30日）
- 评论发布数
- 人均浏览品种数

**二级指标**
- 评论点赞率
- 评论回复率
- 计算器使用次数
- K线查看时长

---

## 7. 项目规划

### 7.1 里程碑计划

| 里程碑 | 交付物 | 预计完成时间 |
|--------|--------|-------------|
| PRD评审 | PRD文档定稿 | W1 |
| UI设计 | 全套UI设计稿 | W2-W3 |
| 技术方案 | 技术架构文档 | W3 |
| 开发完成 | 功能代码 | W4-W8 |
| 测试完成 | 测试报告 | W9-W10 |
| 上线发布 | App Store/Google Play | W11 |

### 7.2 版本规划

**V1.0（本期）**
- 核心功能：首页、行情、汇率、详情页、讨论区、个人中心
- 核心特性：价格锚定评论系统

**V1.1（计划）**
- AI智能分析入口
- 推送通知系统
- 评论话题标签功能

**V2.0（远期）**
- 付费会员体系
- 更多行情品种
- 社区互动增强

---

## 8. 管理后台系统

### 8.1 后台概述

管理后台是运营和技术团队管理App的核心工具，提供数据统计、内容管理、系统配置等功能。采用Web端实现，支持多管理员权限分级。

**技术栈建议**
- 前端：Vue 3 + Element Plus / React + Ant Design
- 后端：复用FastAPI，增加admin路由模块
- 权限：RBAC（基于角色的访问控制）

### 8.2 首页统计概览

#### 8.2.1 页面布局

```
┌─────────────────────────────────────────────────────────────────────────┐
│  贵金属社区 - 管理后台                          👤 管理员  ▼  [退出]    │
├─────────────────────────────────────────────────────────────────────────┤
│ ┌─────┐                                                                 │
│ │ 首页 │  数据交互  多语言  用户管理  内容管理  系统设置                │
│ └─────┘                                                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐       │
│  │ 📊 实时在线  │ │ 👥 总注册数  │ │ 💬 今日评论  │ │ 📱 今日活跃  │       │
│  │    1,234    │ │   58,692    │ │    3,456    │ │   12,350    │       │
│  │  ▲ +15%    │ │  ▲ +328    │ │  ▲ +12%    │ │  ▲ +8%     │       │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘       │
│                                                                         │
│  ┌─────────────────────────────┐ ┌─────────────────────────────┐       │
│  │  📱 各端口在线数             │ │  📊 注册用户分布            │       │
│  │                             │ │                             │       │
│  │  iOS      Android   Web     │ │  [饼图]                     │       │
│  │  ●520     ●680      ●34     │ │  iOS: 45%                  │       │
│  │                             │ │  Android: 52%              │       │
│  │  [实时更新]                 │ │  其他: 3%                  │       │
│  └─────────────────────────────┘ └─────────────────────────────┘       │
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────┐     │
│  │  📈 用户活跃时间段分布（24小时）                               │     │
│  │                                                               │     │
│  │  [折线图]                                                     │     │
│  │     ___                                                       │     │
│  │    /   \              ___                                     │     │
│  │   /     \            /   \                                    │     │
│  │  /       \__________/     \                                   │     │
│  │ 0  2  4  6  8  10 12 14 16 18 20 22 24                       │     │
│  │                                                               │     │
│  │  [今日] [近7天] [近30天]                                      │     │
│  └───────────────────────────────────────────────────────────────┘     │
│                                                                         │
│  ┌─────────────────────────────┐ ┌─────────────────────────────┐       │
│  │  🔥 热门品种TOP5            │ │  💬 今日评论TOP5            │       │
│  │  1. XAU/USD    2.3k评论    │ │  1. 用户A  56条             │       │
│  │  2. USD/CNY    1.8k评论    │ │  2. 用户B  43条             │       │
│  │  3. XAG/USD    1.2k评论    │ │  3. 用户C  38条             │       │
│  │  4. Au(T+D)    890评论     │ │  4. 用户D  32条             │       │
│  │  5. EUR/USD    756评论     │ │  5. 用户E  28条             │       │
│  └─────────────────────────────┘ └─────────────────────────────┘       │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 8.2.2 统计指标详情

**实时数据卡片**

| 指标 | 说明 | 更新频率 |
|-----|------|---------|
| 实时在线用户数 | 当前WebSocket连接数 | 实时 |
| 总注册用户数 | 累计注册用户（含各端口分布）| 实时 |
| 今日评论数 | 当日新增评论数量 | 每分钟 |
| 今日活跃用户 | 当日登录过的用户数 | 每5分钟 |

**各端口统计**

| 端口 | 统计项 |
|-----|-------|
| iOS | 在线数、注册数、日活、版本分布 |
| Android | 在线数、注册数、日活、版本分布 |
| Web（如有）| 在线数、访问量 |

**用户活跃时间段折线图**

- X轴：24小时时间段（0-24点）
- Y轴：活跃用户数
- 支持切换：今日 / 近7天平均 / 近30天平均
- 可识别用户活跃高峰时段，指导运营策略

#### 8.2.3 启动页管理

```
┌───────────────────────────────────────────────────────────────┐
│  🖼️ 启动页管理                                    [+ 新增启动页] │
├───────────────────────────────────────────────────────────────┤
│                                                               │
│  当前启动页                                                   │
│  ┌─────────────┐                                              │
│  │             │  状态: 🟢 生效中                             │
│  │   [预览图]   │  上传时间: 2025-12-20 10:30                 │
│  │             │  展示次数: 128,560                          │
│  │             │  点击率: 3.2%                               │
│  └─────────────┘  [更换] [查看详情]                           │
│                                                               │
├───────────────────────────────────────────────────────────────┤
│  历史启动页                                                   │
│  ┌───────┐ ┌───────┐ ┌───────┐ ┌───────┐                    │
│  │[预览] │ │[预览] │ │[预览] │ │[预览] │                    │
│  │12-15  │ │12-01  │ │11-15  │ │11-01  │                    │
│  │已停用 │ │已停用 │ │已停用 │ │已停用 │                    │
│  └───────┘ └───────┘ └───────┘ └───────┘                    │
└───────────────────────────────────────────────────────────────┘
```

**启动页功能规则**

| 功能 | 说明 |
|-----|------|
| 上传图片 | 支持JPG/PNG，建议尺寸1080x1920（可配置多尺寸适配）|
| 跳转链接 | 可选配置点击跳转URL（活动页、品种详情等）|
| 生效时间 | 可设置定时生效和失效时间 |
| 推送更新 | 更换后通过App热更新机制推送到用户端 |
| 展示规则 | 展示时长（默认3秒）、跳过按钮延迟 |

---

### 8.3 数据交互管理

#### 8.3.1 API状态监控

```
┌───────────────────────────────────────────────────────────────────────────┐
│  🔌 API状态监控                                     [刷新] [导出日志]     │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  API健康状态                                                             │
│  ┌───────────────┐ ┌───────────────┐ ┌───────────────┐ ┌───────────────┐ │
│  │ 🟢 行情API     │ │ 🟢 用户API     │ │ 🟡 评论API     │ │ 🟢 汇率API     │ │
│  │ 响应: 45ms    │ │ 响应: 32ms    │ │ 响应: 156ms   │ │ 响应: 28ms    │ │
│  │ 成功率: 99.9% │ │ 成功率: 99.8% │ │ 成功率: 98.5% │ │ 成功率: 99.9% │ │
│  └───────────────┘ └───────────────┘ └───────────────┘ └───────────────┘ │
│                                                                           │
├───────────────────────────────────────────────────────────────────────────┤
│  实时请求日志                                          [执行日志] [错误日志] │
├───────────────────────────────────────────────────────────────────────────┤
│  时间              接口                方法   状态码   耗时    说明        │
│  ─────────────────────────────────────────────────────────────────────── │
│  10:30:25.123    /api/v1/quotes       GET    200     45ms   ✅ 成功      │
│  10:30:24.892    /api/v1/comments     POST   201     89ms   ✅ 评论创建   │
│  10:30:24.456    /api/v1/auth/login   POST   401     23ms   ⚠️ 密码错误   │
│  10:30:23.789    /api/v1/quotes/kline GET    500     --     ❌ 服务异常   │
│  10:30:22.234    /api/v1/exchange     GET    200     28ms   ✅ 成功      │
│                                                                           │
│  [加载更多...]                                                           │
├───────────────────────────────────────────────────────────────────────────┤
│  错误日志详情                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │ ❌ 错误码: 500                                                       │ │
│  │ 📍 接口: /api/v1/quotes/kline                                       │ │
│  │ 🕐 时间: 2025-12-25 10:30:23.789                                    │ │
│  │ 📝 错误信息: 行情数据源连接超时                                       │ │
│  │ 🔍 堆栈追踪:                                                         │ │
│  │    File "quote_service.py", line 45, in get_kline                   │ │
│  │    TimeoutError: Connection to data provider timed out              │ │
│  │                                                                      │ │
│  │ 💡 建议处理: 检查行情数据源API连接状态，考虑切换备用数据源           │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
└───────────────────────────────────────────────────────────────────────────┘
```

**API状态说明**

| 状态 | 图标 | 说明 |
|-----|------|------|
| 正常 | 🟢 | 响应时间<100ms，成功率>99% |
| 警告 | 🟡 | 响应时间100-500ms，或成功率95-99% |
| 异常 | 🔴 | 响应时间>500ms，或成功率<95% |

**错误码自然语言映射**

| 错误码 | 自然语言说明 |
|-------|-------------|
| 400 | ⚠️ 请求参数错误：客户端请求格式不正确 |
| 401 | 🔐 认证失败：用户未登录或Token过期 |
| 403 | 🚫 权限不足：用户无权访问此资源 |
| 404 | 🔍 资源不存在：请求的数据未找到 |
| 429 | ⏳ 请求过于频繁：触发限流保护 |
| 500 | ❌ 服务器内部错误：请检查后端服务状态 |
| 502 | 🌐 网关错误：上游服务不可用 |
| 503 | 🔧 服务暂时不可用：系统维护中 |
| 504 | ⏰ 请求超时：服务响应时间过长 |

#### 8.3.2 商业API数据源切换

```
┌───────────────────────────────────────────────────────────────────────────┐
│  📡 商业API数据源管理                                      [+ 添加数据源]  │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  当前数据源配置                                                          │
│                                                                           │
│  行情数据源                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐  │
│  │  🟢 主数据源: [万得Wind API          ▼]                            │  │
│  │     状态: 正常运行                                                  │  │
│  │     延迟: 平均45ms                                                  │  │
│  │     今日调用: 1,234,567次                                          │  │
│  │                                                                     │  │
│  │  🟡 备用数据源: [金十数据API         ▼]                            │  │
│  │     状态: 待命                                                      │  │
│  │     自动切换阈值: 主数据源连续失败3次                               │  │
│  │                                                                     │  │
│  │  [测试连接]  [立即切换]  [配置自动切换规则]                        │  │
│  └────────────────────────────────────────────────────────────────────┘  │
│                                                                           │
│  汇率数据源                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐  │
│  │  🟢 当前: [Fixer.io API             ▼]                             │  │
│  │                                                                     │  │
│  │  可选数据源:                                                        │  │
│  │  ├── Fixer.io API ✓                                                │  │
│  │  ├── Open Exchange Rates                                           │  │
│  │  ├── Currency Layer                                                │  │
│  │  └── 中国银行汇率                                                   │  │
│  │                                                                     │  │
│  │  [测试连接]  [切换数据源]                                          │  │
│  └────────────────────────────────────────────────────────────────────┘  │
│                                                                           │
├───────────────────────────────────────────────────────────────────────────┤
│  ⚠️ 切换提示                                                             │
│  切换数据源将影响前端实时行情显示，建议在低峰期操作。                    │
│  切换后请在5分钟内验证数据准确性。                                       │
└───────────────────────────────────────────────────────────────────────────┘
```

**数据源切换功能**

| 功能 | 说明 |
|-----|------|
| 下拉切换 | 从预配置的数据源列表中选择 |
| 测试连接 | 验证API密钥和连接是否正常 |
| 立即切换 | 手动切换到指定数据源 |
| 自动切换 | 主数据源异常时自动切换到备用 |
| 切换日志 | 记录所有切换操作和原因 |

#### 8.3.3 数据库管理

```
┌───────────────────────────────────────────────────────────────────────────┐
│  🗄️ 应用数据库                                        [备份] [优化] [SQL]  │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  数据库状态                                                              │
│  ┌──────────────────┐ ┌──────────────────┐ ┌──────────────────┐          │
│  │ 💾 存储使用       │ │ 📊 连接数        │ │ ⚡ QPS           │          │
│  │ 45.6 GB / 100 GB │ │ 28 / 100        │ │ 1,234           │          │
│  │ [███████░░░] 46% │ │ [██░░░░░░] 28%  │ │ ▲ 正常          │          │
│  └──────────────────┘ └──────────────────┘ └──────────────────┘          │
│                                                                           │
│  核心数据表                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │ 表名           记录数        大小       最后更新        操作        │ │
│  │ ──────────────────────────────────────────────────────────────────│ │
│  │ users          58,692       125 MB     刚刚            [查看] [导出]│ │
│  │ comments       1,234,567    2.3 GB     刚刚            [查看] [清理]│ │
│  │ comment_likes  5,678,901    890 MB     刚刚            [查看] [清理]│ │
│  │ user_favorites 89,012       45 MB      5分钟前         [查看]      │ │
│  │ topics         1,234        2 MB       1小时前         [查看] [编辑]│ │
│  │ symbols        156          1 MB       1天前           [查看] [编辑]│ │
│  └─────────────────────────────────────────────────────────────────────┘ │
│                                                                           │
│  自动备份计划: 每日 03:00 全量备份，每小时增量备份                       │
│  最近备份: 2025-12-25 03:00:15 [下载] [恢复]                            │
└───────────────────────────────────────────────────────────────────────────┘
```

---

### 8.4 多语言管理

#### 8.4.1 页面布局

```
┌───────────────────────────────────────────────────────────────────────────┐
│  🌍 多语言管理                                           [+ 新增语言]     │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  已支持语言                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │ 语言        代码     翻译进度      状态       操作                  │ │
│  │ ──────────────────────────────────────────────────────────────────│ │
│  │ 🇨🇳 简体中文  zh_CN   100%  ████████  🟢 已启用  [编辑] [导出]      │ │
│  │ 🇺🇸 English   en_US   100%  ████████  🟢 已启用  [编辑] [导出]      │ │
│  │ 🇯🇵 日本語    ja_JP   95%   ███████░  🟢 已启用  [编辑] [导出]      │ │
│  │ 🇰🇷 한국어    ko_KR   90%   ███████░  🟢 已启用  [编辑] [导出]      │ │
│  │ 🇹🇼 繁體中文  zh_TW   0%    ░░░░░░░░  🔘 未启用  [编辑] [导出]      │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
│                                                                           │
├───────────────────────────────────────────────────────────────────────────┤
│  翻译编辑器                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │ 筛选: [全部 ▼]  模块: [首页 ▼]  状态: [未翻译优先 ▼]   [搜索...]   │ │
│  ├─────────────────────────────────────────────────────────────────────┤ │
│  │ Key              简体中文      English       日本語        한국어   │ │
│  │ ──────────────────────────────────────────────────────────────────│ │
│  │ home.title       首页          Home          ホーム        홈       │ │
│  │ home.search      搜索品种...   Search...     検索...       검색...   │ │
│  │ market.gold      黄金          Gold          ゴールド      금        │ │
│  │ market.silver    白银          Silver        シルバー      은        │ │
│  │ comment.price_at 评论时价格    Price at      コメント時    댓글 시   │ │
│  │ comment.like     点赞          Like          いいね        좋아요    │ │
│  │ comment.reply    回复          Reply         返信          답글      │ │
│  │ ...                                                                  │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
│                                                                           │
│  [保存所有更改]  [导入翻译文件]  [导出翻译文件]  [同步到App]             │
└───────────────────────────────────────────────────────────────────────────┘
```

#### 8.4.2 多语言功能规则

**支持的语言（初始四大语言）**

| 语言 | 代码 | 优先级 | 说明 |
|-----|------|-------|------|
| 简体中文 | zh_CN | 1 | 默认语言，优先维护 |
| English | en_US | 2 | 国际用户 |
| 日本語 | ja_JP | 3 | 日本市场 |
| 한국어 | ko_KR | 4 | 韩国市场 |

**翻译管理功能**

| 功能 | 说明 |
|-----|------|
| 在线编辑 | 直接在后台编辑各语言翻译 |
| 批量导入 | 支持Excel/JSON格式批量导入翻译 |
| 批量导出 | 导出翻译文件供翻译人员处理 |
| 新增语言 | 随时添加新语言支持 |
| 翻译进度 | 自动统计各语言翻译完成度 |
| 同步推送 | 更新后通过热更新推送到App |

**翻译Key命名规范**

```
模块.页面.元素
例如:
- home.title          → 首页标题
- market.gold.spot    → 行情页-黄金-现货
- comment.price_at    → 评论区-评论时价格
- profile.settings    → 个人中心-设置
- error.network       → 错误提示-网络错误
```

---

### 8.5 用户管理

#### 8.5.1 用户列表

```
┌───────────────────────────────────────────────────────────────────────────┐
│  👥 用户管理                                              [导出] [筛选]   │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  快速筛选: [全部用户 ▼]  注册端口: [全部 ▼]  状态: [全部 ▼]              │
│  搜索: [用户ID/手机号/邮箱...]                              [搜索]       │
│                                                                           │
├───────────────────────────────────────────────────────────────────────────┤
│ ID        昵称       手机号        邮箱         注册方式   端口   状态  操作│
│ ────────────────────────────────────────────────────────────────────────│
│ U001234  投资达人A  138****8888  a**@qq.com   手机号    iOS   🟢正常 [详情]│
│ U001235  金银爱好者 139****9999  b**@gmail    Google   Android 🟢正常 [详情]│
│ U001236  汇率观察   --           c**@163.com  Apple    iOS   🟡禁言 [详情]│
│ U001237  黄金时代   137****7777  --           微信     Android 🔴封禁 [详情]│
│ ...                                                                       │
│                                                                           │
│ 共 58,692 条记录                              [< 上一页] 1/587 [下一页 >] │
└───────────────────────────────────────────────────────────────────────────┘
```

#### 8.5.2 用户详情

```
┌───────────────────────────────────────────────────────────────────────────┐
│  👤 用户详情 - U001234                                    [← 返回列表]    │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  基本信息                                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │  ┌────────┐                                                         │ │
│  │  │  头像  │  昵称: 投资达人A                                        │ │
│  │  │        │  用户ID: U001234                                        │ │
│  │  └────────┘  简介: 关注贵金属投资8年                                 │ │
│  │                                                                      │ │
│  │  📱 手机号: 138****8888 (已绑定)                                     │ │
│  │  📧 邮箱: a**@qq.com (已绑定)                                        │ │
│  │  🔵 Google: 已绑定                                                   │ │
│  │  🍎 Apple: 未绑定                                                    │ │
│  │  💚 微信: 已绑定                                                     │ │
│  │                                                                      │ │
│  │  注册时间: 2024-03-15 10:30:25                                      │ │
│  │  注册端口: iOS                                                       │ │
│  │  最后登录: 2025-12-25 09:15:30                                      │ │
│  │  累计登录: 256 天                                                    │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
│                                                                           │
│  用户行为统计                                                            │
│  ┌───────────────┐ ┌───────────────┐ ┌───────────────┐ ┌───────────────┐│
│  │ 💬 评论数      │ │ ❤️ 获赞数      │ │ ⭐ 收藏品种    │ │ 📊 活跃天数   ││
│  │    1,234      │ │    5,678      │ │    12         │ │    256        ││
│  └───────────────┘ └───────────────┘ └───────────────┘ └───────────────┘│
│                                                                           │
│  管理操作                                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │  当前状态: 🟢 正常                                                   │ │
│  │                                                                      │ │
│  │  [禁言用户]  [封禁账号]  [解除限制]  [重置密码]  [查看操作日志]     │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
└───────────────────────────────────────────────────────────────────────────┘
```

#### 8.5.3 用户状态管理

| 状态 | 说明 | 影响范围 |
|-----|------|---------|
| 🟢 正常 | 正常使用所有功能 | - |
| 🟡 禁言 | 不能发布评论和回复 | 评论功能 |
| 🔴 封禁 | 账号被封禁，无法登录 | 全部功能 |

---

### 8.6 内容管理

#### 8.6.1 评论管理

```
┌───────────────────────────────────────────────────────────────────────────┐
│  💬 评论管理                                    [批量操作 ▼] [导出] [筛选]│
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  筛选: 品种[全部 ▼] 状态[全部 ▼] 时间[最近7天 ▼]  举报[全部 ▼]           │
│  搜索: [评论内容/用户ID...]                                  [搜索]      │
│                                                                           │
├───────────────────────────────────────────────────────────────────────────┤
│ ☐ ID        用户      品种      评论内容          时间      状态    操作 │
│ ─────────────────────────────────────────────────────────────────────── │
│ ☐ C001234  投资达人A  XAU/USD  感觉要突破2660... 10分钟前  🟢正常 [详情]│
│ ☐ C001235  用户B      USD/CNY  [敏感词已替换]    30分钟前  🟡审核中[审核]│
│ ☐ C001236  用户C      XAG/USD  垃圾评论内容...   1小时前   ⚠️被举报 [处理]│
│ ☐ C001237  用户D      Au(T+D)  广告链接...       2小时前   🔴已删除[恢复]│
│ ...                                                                       │
│                                                                           │
│ 已选 0 条                                       [< 上一页] 1/1234 [下一页 >]│
└───────────────────────────────────────────────────────────────────────────┘
```

#### 8.6.2 评论详情与处理

```
┌───────────────────────────────────────────────────────────────────────────┐
│  💬 评论详情 - C001236                                    [← 返回列表]    │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  评论信息                                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │  👤 用户: 用户C (U001236)                                           │ │
│  │  📊 品种: XAG/USD (伦敦银)                                          │ │
│  │  💰 评论时价格: $30.25                                              │ │
│  │  🕐 发布时间: 2025-12-25 08:30:15                                   │ │
│  │                                                                      │ │
│  │  评论内容:                                                           │ │
│  │  ┌─────────────────────────────────────────────────────────────┐    │ │
│  │  │ 这个评论包含一些不当内容...                                  │    │ │
│  │  └─────────────────────────────────────────────────────────────┘    │ │
│  │                                                                      │ │
│  │  ❤️ 点赞: 56    💬 回复: 8                                          │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
│                                                                           │
│  举报信息                                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │  ⚠️ 该评论被举报 3 次                                               │ │
│  │                                                                      │ │
│  │  举报原因:                                                           │ │
│  │  ├── 垃圾广告 (2次)                                                 │ │
│  │  └── 不当言论 (1次)                                                 │ │
│  │                                                                      │ │
│  │  举报用户: 用户A, 用户B, 用户E                                      │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
│                                                                           │
│  处理操作                                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │                                                                      │ │
│  │  [✓ 通过审核]  [🚫 删除评论]  [🔇 屏蔽评论]  [⚠️ 警告用户]  [🔒 禁言用户]│ │
│  │                                                                      │ │
│  │  处理备注: [                                           ]            │ │
│  │                                                                      │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
└───────────────────────────────────────────────────────────────────────────┘
```

#### 8.6.3 评论处理规则

| 操作 | 说明 | 对用户影响 |
|-----|------|----------|
| ✓ 通过审核 | 确认评论无问题 | 评论正常显示 |
| 🚫 删除评论 | 永久删除，不可恢复 | 评论不可见，通知用户 |
| 🔇 屏蔽评论 | 隐藏评论，可恢复 | 仅发布者可见 |
| ⚠️ 警告用户 | 发送警告通知 | 收到系统警告 |
| 🔒 禁言用户 | 限制评论功能 | 无法发布新评论 |

---

### 8.7 后台权限管理

#### 8.7.1 角色与权限

| 角色 | 权限范围 |
|-----|---------|
| 超级管理员 | 所有功能，包括管理员账号管理 |
| 运营管理员 | 用户管理、内容管理、多语言、启动页 |
| 数据管理员 | 首页统计、API监控、数据库管理 |
| 内容审核员 | 仅评论审核和处理 |
| 只读管理员 | 仅查看，无编辑权限 |

#### 8.7.2 操作日志

所有后台操作均记录日志：
- 操作时间
- 操作人
- 操作类型
- 操作对象
- 操作详情
- IP地址

---

## 9. 技术架构设计

### 9.1 整体架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        客户端 (Flutter)                          │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────────────┐ │
│  │ iOS App  │  │Android App│  │ 状态管理  │  │ WebSocket Client│ │
│  └──────────┘  └──────────┘  │ (Riverpod)│  │  (实时行情)     │ │
│                              └──────────┘  └──────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────┐
│                      API Gateway / Nginx                        │
│                   (负载均衡、SSL终止、限流)                       │
└─────────────────────────────────────────────────────────────────┘
                                    │
                    ┌───────────────┼───────────────┐
                    ▼               ▼               ▼
┌──────────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│   FastAPI 服务       │  │  WebSocket 服务  │  │   定时任务服务   │
│  ┌────────────────┐  │  │  (实时行情推送)  │  │  (Celery/APScheduler)│
│  │ 用户认证模块   │  │  │                 │  │  ┌─────────────┐ │
│  │ 行情查询模块   │  │  │                 │  │  │ 行情数据同步│ │
│  │ 评论社区模块   │  │  │                 │  │  │ 榜单计算    │ │
│  │ 计算器模块     │  │  │                 │  │  │ 数据清理    │ │
│  └────────────────┘  │  │                 │  │  └─────────────┘ │
└──────────────────────┘  └─────────────────┘  └─────────────────┘
            │                       │                   │
            └───────────────────────┼───────────────────┘
                                    ▼
┌─────────────────────────────────────────────────────────────────┐
│                          数据层                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────────┐   │
│  │  PostgreSQL  │  │    Redis     │  │   第三方行情API       │   │
│  │  (主数据库)   │  │  (缓存/队列) │  │  (数据源接入)        │   │
│  └──────────────┘  └──────────────┘  └──────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

### 9.2 Flutter 客户端架构

#### 9.2.1 技术选型

| 组件 | 技术方案 | 说明 |
|-----|---------|------|
| 状态管理 | Riverpod | 响应式状态管理，支持依赖注入 |
| 网络请求 | Dio | HTTP客户端，支持拦截器 |
| 实时通信 | web_socket_channel | WebSocket连接 |
| K线图表 | fl_chart / k_chart | 专业金融图表组件 |
| 本地存储 | shared_preferences + Hive | 配置存储 + 结构化数据缓存 |
| 路由管理 | go_router | 声明式路由 |
| 国际化 | flutter_localizations + intl | 多语言支持 |

#### 9.2.2 项目结构

```
lib/
├── main.dart
├── app/
│   ├── app.dart                    # App入口
│   ├── routes/                     # 路由配置
│   └── theme/                      # 主题配置（含红涨绿跌切换）
├── core/
│   ├── constants/                  # 常量定义
│   ├── network/                    # 网络层
│   │   ├── api_client.dart         # Dio封装
│   │   ├── websocket_client.dart   # WebSocket封装
│   │   └── interceptors/           # 拦截器
│   ├── storage/                    # 本地存储
│   └── utils/                      # 工具类
├── features/
│   ├── home/                       # 首页模块
│   │   ├── data/                   # 数据层
│   │   ├── domain/                 # 领域层
│   │   └── presentation/           # 展示层
│   ├── market/                     # 行情模块
│   ├── exchange/                   # 汇率模块
│   ├── detail/                     # 详情页模块
│   │   ├── widgets/
│   │   │   ├── kline_chart.dart    # K线图组件
│   │   │   └── comment_section.dart # 评论区组件
│   │   └── ...
│   ├── community/                  # 讨论区模块
│   └── profile/                    # 个人中心模块
├── models/                         # 数据模型
│   ├── symbol.dart                 # 品种模型
│   ├── quote.dart                  # 行情模型
│   ├── comment.dart                # 评论模型
│   └── user.dart                   # 用户模型
├── providers/                      # Riverpod Providers
│   ├── quote_provider.dart         # 行情状态
│   ├── auth_provider.dart          # 认证状态
│   └── settings_provider.dart      # 设置状态
└── widgets/                        # 通用组件
    ├── quote_card.dart             # 行情卡片
    ├── comment_item.dart           # 评论项
    └── price_tag.dart              # 价格锚定标签
```

### 9.3 FastAPI 后端架构

#### 9.3.1 技术选型

| 组件 | 技术方案 | 说明 |
|-----|---------|------|
| Web框架 | FastAPI | 高性能异步框架，自动API文档 |
| ORM | SQLAlchemy 2.0 + asyncpg | 异步数据库操作 |
| 数据库 | PostgreSQL | 主数据库 |
| 缓存 | Redis | 行情缓存、会话管理、排行榜 |
| 任务队列 | Celery / APScheduler | 定时任务、异步任务 |
| 认证 | JWT + OAuth2 | 用户认证 |
| WebSocket | FastAPI WebSocket | 实时行情推送 |

#### 9.3.2 项目结构

```
backend/
├── app/
│   ├── main.py                     # FastAPI入口
│   ├── config.py                   # 配置管理
│   ├── database.py                 # 数据库连接
│   ├── api/
│   │   ├── v1/
│   │   │   ├── __init__.py
│   │   │   ├── auth.py             # 认证接口
│   │   │   ├── quotes.py           # 行情接口
│   │   │   ├── symbols.py          # 品种接口
│   │   │   ├── comments.py         # 评论接口
│   │   │   ├── exchange.py         # 汇率计算接口
│   │   │   ├── community.py        # 社区榜单接口
│   │   │   └── users.py            # 用户接口
│   │   └── websocket/
│   │       └── quotes_ws.py        # 行情WebSocket
│   ├── models/
│   │   ├── user.py
│   │   ├── symbol.py
│   │   ├── quote.py
│   │   ├── comment.py
│   │   └── topic.py
│   ├── schemas/                    # Pydantic模型
│   │   ├── user.py
│   │   ├── quote.py
│   │   └── comment.py
│   ├── services/
│   │   ├── auth_service.py
│   │   ├── quote_service.py
│   │   ├── comment_service.py
│   │   └── ranking_service.py      # 榜单计算服务
│   ├── tasks/
│   │   ├── quote_sync.py           # 行情数据同步任务
│   │   └── ranking_update.py       # 榜单更新任务
│   └── utils/
│       ├── security.py             # 安全工具
│       └── validators.py           # 校验器
├── migrations/                     # 数据库迁移 (Alembic)
├── tests/
├── requirements.txt
├── Dockerfile
└── docker-compose.yml
```

### 9.4 核心API设计

#### 9.4.1 API接口列表

**认证模块 `/api/v1/auth`**

| 方法 | 路径 | 说明 |
|-----|------|------|
| POST | /login/phone | 手机号验证码登录 |
| POST | /login/google | Google OAuth登录 |
| POST | /login/apple | Apple登录 |
| POST | /bind/wechat | 绑定微信 |
| DELETE | /bind/wechat | 解绑微信 |
| POST | /refresh | 刷新Token |

**行情模块 `/api/v1/quotes`**

| 方法 | 路径 | 说明 |
|-----|------|------|
| GET | /symbols | 获取品种列表 |
| GET | /symbols/{code} | 获取品种详情 |
| GET | /realtime | 获取实时行情（批量）|
| GET | /realtime/{code} | 获取单个品种实时行情 |
| GET | /kline/{code} | 获取K线数据 |
| WS | /ws/quotes | WebSocket实时行情订阅 |

**汇率模块 `/api/v1/exchange`**

| 方法 | 路径 | 说明 |
|-----|------|------|
| GET | /rates | 获取所有汇率 |
| GET | /convert | 货币换算 |

**评论模块 `/api/v1/comments`**

| 方法 | 路径 | 说明 |
|-----|------|------|
| GET | /{symbol_code} | 获取品种评论列表 |
| POST | / | 发布评论（含价格锚定）|
| POST | /{id}/reply | 回复评论 |
| POST | /{id}/like | 点赞评论 |
| DELETE | /{id}/like | 取消点赞 |
| DELETE | /{id} | 删除评论 |

**社区模块 `/api/v1/community`**

| 方法 | 路径 | 说明 |
|-----|------|------|
| GET | /topics/hot | 热门话题榜 |
| GET | /symbols/popular | 品种关注榜 |
| GET | /comments/top | 评论点赞榜 |
| GET | /predictions/leaderboard | 预测达人榜 |

**预测模块 `/api/v1/predictions`（新增）**

| 方法 | 路径 | 说明 |
|-----|------|------|
| GET | / | 获取预测列表（支持筛选：进行中/已结束/我发起的/我参与的）|
| GET | /{id} | 获取预测详情 |
| POST | / | 发起预测（含价格锚定）|
| POST | /{id}/vote | 参与投票 |
| POST | /{id}/verify | 手动公布结果（发起人操作）|
| GET | /{id}/comments | 获取预测讨论列表 |
| POST | /{id}/comments | 发表预测讨论（含价格锚定）|
| GET | /my/stats | 获取我的预测成绩 |
| GET | /my/records | 获取我的预测记录 |
| GET | /leaderboard/accuracy | 准确率排行榜 |
| GET | /leaderboard/score | 积分排行榜 |
| GET | /leaderboard/streak | 连胜排行榜 |
| GET | /hot | 热门进行中预测 |

#### 9.4.2 核心接口示例

**发布评论（带价格锚定）**

```python
# POST /api/v1/comments
# Request
{
    "symbol_code": "XAUUSD",
    "content": "感觉要突破2660了，准备加仓！",
    "parent_id": null  # 如果是回复则填父评论ID
}

# Response
{
    "id": "comment_123456",
    "user": {
        "id": "user_789",
        "nickname": "投资达人A",
        "avatar": "https://..."
    },
    "symbol_code": "XAUUSD",
    "content": "感觉要突破2660了，准备加仓！",
    "price_at_comment": 2650.30,  # 系统自动记录的评论时价格
    "created_at": "2025-12-25T10:30:00Z",
    "likes_count": 0,
    "replies_count": 0
}
```

**WebSocket行情订阅**

```python
# 连接: ws://api.example.com/api/v1/ws/quotes

# 订阅消息
{
    "action": "subscribe",
    "symbols": ["XAUUSD", "XAGUSD", "USDCNY"]
}

# 行情推送
{
    "type": "quote",
    "data": {
        "symbol": "XAUUSD",
        "price": 2658.50,
        "change": 28.30,
        "change_percent": 1.08,
        "high": 2665.20,
        "low": 2630.00,
        "timestamp": "2025-12-25T10:30:05Z"
    }
}
```

### 9.5 数据库设计

#### 9.5.1 核心表结构

```sql
-- 用户表
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    phone VARCHAR(20) UNIQUE,
    nickname VARCHAR(50) NOT NULL,
    avatar VARCHAR(500),
    bio VARCHAR(200),
    google_id VARCHAR(100) UNIQUE,
    apple_id VARCHAR(100) UNIQUE,
    wechat_openid VARCHAR(100) UNIQUE,
    color_scheme VARCHAR(20) DEFAULT 'red_up',  -- red_up/green_up
    language VARCHAR(10) DEFAULT 'zh_CN',
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- 品种表
CREATE TABLE symbols (
    code VARCHAR(20) PRIMARY KEY,
    name_cn VARCHAR(50) NOT NULL,
    name_en VARCHAR(50) NOT NULL,
    market VARCHAR(20) NOT NULL,
    symbol_type VARCHAR(20) NOT NULL,
    base_currency VARCHAR(10),
    quote_currency VARCHAR(10),
    decimal_places INT DEFAULT 2,
    unit VARCHAR(20),
    description TEXT,
    is_active BOOLEAN DEFAULT TRUE,
    sort_order INT DEFAULT 0
);

-- 评论表
CREATE TABLE comments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    symbol_code VARCHAR(20) REFERENCES symbols(code),
    content TEXT NOT NULL,
    price_at_comment DECIMAL(20, 6) NOT NULL,  -- 关键：评论时价格
    parent_id UUID REFERENCES comments(id),
    likes_count INT DEFAULT 0,
    replies_count INT DEFAULT 0,
    is_deleted BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT NOW()
);

-- 评论点赞表
CREATE TABLE comment_likes (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    comment_id UUID REFERENCES comments(id),
    user_id UUID REFERENCES users(id),
    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(comment_id, user_id)
);

-- 用户收藏品种表
CREATE TABLE user_favorites (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    symbol_code VARCHAR(20) REFERENCES symbols(code),
    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(user_id, symbol_code)
);

-- 话题表
CREATE TABLE topics (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100) NOT NULL UNIQUE,
    description TEXT,
    discussion_count INT DEFAULT 0,
    heat_score INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT NOW()
);

-- 预测表（新增）
CREATE TABLE predictions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    symbol_code VARCHAR(20) REFERENCES symbols(code),
    question TEXT NOT NULL,                          -- 预测问题
    options JSONB NOT NULL,                          -- 选项列表 [{"key": "A", "text": "涨超1%"}, ...]
    price_at_create DECIMAL(20, 6) NOT NULL,         -- 发起时价格
    price_at_verify DECIMAL(20, 6),                  -- 验证时价格
    verify_time TIMESTAMP NOT NULL,                  -- 验证时间
    correct_option VARCHAR(1),                       -- 正确答案 (A/B/C/D)
    verify_rule VARCHAR(20) DEFAULT 'auto',          -- 验证规则 (auto/manual)
    auto_verify_conditions JSONB,                    -- 自动验证条件
    status VARCHAR(20) DEFAULT 'active',             -- 状态 (active/ended/cancelled)
    participants_count INT DEFAULT 0,
    comments_count INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- 预测投票表（新增）
CREATE TABLE prediction_votes (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    prediction_id UUID REFERENCES predictions(id),
    user_id UUID REFERENCES users(id),
    selected_option VARCHAR(1) NOT NULL,             -- 选择的选项 (A/B/C/D)
    price_at_vote DECIMAL(20, 6) NOT NULL,           -- 投票时价格
    is_correct BOOLEAN,                              -- 是否正确（结果揭晓后更新）
    voted_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(prediction_id, user_id)
);

-- 预测讨论表（新增）
CREATE TABLE prediction_comments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    prediction_id UUID REFERENCES predictions(id),
    user_id UUID REFERENCES users(id),
    content TEXT NOT NULL,
    price_at_comment DECIMAL(20, 6) NOT NULL,        -- 评论时价格
    parent_id UUID REFERENCES prediction_comments(id),
    likes_count INT DEFAULT 0,
    replies_count INT DEFAULT 0,
    is_deleted BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT NOW()
);

-- 用户预测成绩表（新增）
CREATE TABLE user_prediction_stats (
    user_id UUID PRIMARY KEY REFERENCES users(id),
    total_predictions INT DEFAULT 0,                 -- 发起的预测总数
    total_participations INT DEFAULT 0,              -- 参与的预测总数
    correct_count INT DEFAULT 0,                     -- 正确次数
    accuracy_rate DECIMAL(5, 2) DEFAULT 0,           -- 准确率（百分比）
    streak_correct INT DEFAULT 0,                    -- 当前连续正确次数
    max_streak INT DEFAULT 0,                        -- 历史最高连胜
    prediction_score INT DEFAULT 0,                  -- 预测积分
    rank_title VARCHAR(50) DEFAULT '预测新手',        -- 称号
    updated_at TIMESTAMP DEFAULT NOW()
);

-- 预测积分记录表（新增）
CREATE TABLE prediction_score_logs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    prediction_id UUID REFERENCES predictions(id),
    action VARCHAR(50) NOT NULL,                     -- 行为类型
    score_change INT NOT NULL,                       -- 积分变化
    description TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

-- 创建索引
CREATE INDEX idx_predictions_symbol ON predictions(symbol_code);
CREATE INDEX idx_predictions_status ON predictions(status);
CREATE INDEX idx_predictions_verify_time ON predictions(verify_time);
CREATE INDEX idx_prediction_votes_prediction ON prediction_votes(prediction_id);
CREATE INDEX idx_prediction_votes_user ON prediction_votes(user_id);
CREATE INDEX idx_user_prediction_stats_accuracy ON user_prediction_stats(accuracy_rate DESC);
CREATE INDEX idx_user_prediction_stats_score ON user_prediction_stats(prediction_score DESC);
CREATE INDEX idx_user_prediction_stats_streak ON user_prediction_stats(streak_correct DESC);
```

### 9.6 部署架构

```
┌─────────────────────────────────────────────────────────────┐
│                    Cloud Provider (AWS/阿里云)               │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐     ┌─────────────────────────────────┐   │
│  │   CDN       │────▶│  静态资源 (Flutter Web/Assets)   │   │
│  └─────────────┘     └─────────────────────────────────┘   │
│                                                             │
│  ┌─────────────┐     ┌─────────────────────────────────┐   │
│  │ Load Balancer│────▶│     Kubernetes / ECS            │   │
│  │  (ALB/SLB)  │     │  ┌───────────────────────────┐  │   │
│  └─────────────┘     │  │  FastAPI Pods (x3)        │  │   │
│                      │  └───────────────────────────┘  │   │
│                      │  ┌───────────────────────────┐  │   │
│                      │  │  WebSocket Pods (x2)      │  │   │
│                      │  └───────────────────────────┘  │   │
│                      │  ┌───────────────────────────┐  │   │
│                      │  │  Celery Workers (x2)      │  │   │
│                      │  └───────────────────────────┘  │   │
│                      └─────────────────────────────────┘   │
│                                     │                       │
│                      ┌──────────────┴──────────────┐       │
│                      ▼                             ▼       │
│            ┌─────────────────┐          ┌─────────────────┐│
│            │   PostgreSQL    │          │     Redis       ││
│            │   (RDS/主从)    │          │   (ElastiCache) ││
│            └─────────────────┘          └─────────────────┘│
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 10. 附录

### 10.1 名词解释

| 术语 | 解释 |
|------|------|
| 价格锚定 | 评论发布时自动记录并展示当时的实时价格 |
| 价格预测 | 用户发起的对未来价格走势的投票互动，系统自动验证结果 |
| 预测准确率 | 用户预测正确次数占参与预测总数的百分比 |
| 预测积分 | 用户通过预测活动获得的积分，用于排名和称号评定 |
| 连胜 | 连续预测正确的次数 |
| K线图 | 金融市场常用的价格走势图表 |
| XAU/USD | 黄金兑美元的国际报价代码（伦敦金）|
| XAG/USD | 白银兑美元的国际报价代码（伦敦银）|
| SGE | 上海黄金交易所 (Shanghai Gold Exchange) |
| LBMA | 伦敦金银市场协会 (London Bullion Market Association) |
| COMEX | 纽约商品交易所 (Commodity Exchange) |
| T+D | 延期交收合约，支持保证金交易和双向操作 |
| Au99.99 | 上海黄金交易所实盘合约，黄金纯度不低于99.99% |
| SHAU | 上海金，人民币定价的黄金基准价格 |
| GC | COMEX黄金期货合约代码 |
| SI | COMEX白银期货合约代码 |

### 10.2 UI参考说明

根据需求描述：
- 首页UI布局：参考第一张截图（网格卡片布局，不含底部导航）
- 行情页UI布局：参考第二张截图（分类导航+列表，不含底部导航）
- 评论区布局：参考第三张截图（小红书风格评论列表）
- 评论对话逻辑：参考X(Twitter)的评论回复机制

### 10.3 竞品参考

- 英为财情（Investing.com）- 行情数据展示参考
- 金十数据 - 资讯展示参考
- 小红书 - 评论区UI布局参考
- X(Twitter) - 评论对话逻辑参考

---

**文档结束**

---

*本PRD由Claude基于产品经理最佳实践生成，如有疑问请与产品负责人确认。*
