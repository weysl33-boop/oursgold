import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import '../core/providers/providers.dart';
import '../features/home/home_page.dart';
import '../features/quotes/quotes_page.dart';
import '../features/forex/forex_page.dart';
import '../features/community/community_page.dart';
import '../features/profile/profile_page.dart';

/// Bottom navigation shell with 5 tabs
class BottomNavShell extends ConsumerWidget {
  const BottomNavShell({super.key});

  static const List<_NavItem> _navItems = [
    _NavItem(
      label: '首页',
      icon: Icons.home_outlined,
      selectedIcon: Icons.home,
      page: HomePage(),
    ),
    _NavItem(
      label: '行情',
      icon: Icons.show_chart_outlined,
      selectedIcon: Icons.show_chart,
      page: QuotesPage(),
    ),
    _NavItem(
      label: '外汇',
      icon: Icons.currency_exchange_outlined,
      selectedIcon: Icons.currency_exchange,
      page: ForexPage(),
    ),
    _NavItem(
      label: '社区',
      icon: Icons.groups_outlined,
      selectedIcon: Icons.groups,
      page: CommunityPage(),
    ),
    _NavItem(
      label: '我的',
      icon: Icons.person_outline,
      selectedIcon: Icons.person,
      page: ProfilePage(),
    ),
  ];

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final currentIndex = ref.watch(currentIndexProvider);

    return Scaffold(
      body: SafeArea(
        child: IndexedStack(
          index: currentIndex,
          children: _navItems.map((item) => item.page).toList(),
        ),
      ),
      bottomNavigationBar: BottomNavigationBar(
        currentIndex: currentIndex,
        onTap: (index) {
          // Add haptic feedback
          if (index != currentIndex) {
            ref.read(currentIndexProvider.notifier).state = index;
          }
        },
        type: BottomNavigationBarType.fixed,
        selectedFontSize: 12,
        unselectedFontSize: 12,
        items: _navItems.map((item) {
          return BottomNavigationBarItem(
            icon: Icon(item.icon),
            activeIcon: Icon(item.selectedIcon),
            label: item.label,
          );
        }).toList(),
      ),
    );
  }
}

class _NavItem {
  final String label;
  final IconData icon;
  final IconData selectedIcon;
  final Widget page;

  const _NavItem({
    required this.label,
    required this.icon,
    required this.selectedIcon,
    required this.page,
  });
}
